<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light only">
  <link rel="icon" type="image/jpeg" href="logo.jpg">
  <link rel="shortcut icon" type="image/jpeg" href="logo.jpg">
  <link rel="apple-touch-icon" href="logo.jpg">
  <title>Matka Custum - Paintz | מטקה מותאם אישית - פיינטז</title>
  <link href="https://fonts.googleapis.com/css2?family=Amatica+SC:wght@700&family=Amatic+SC:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="file-upload-styles.css">
  <style>
    /* גלילה פשוטה וישירה */
    html {
      overflow: hidden auto !important;
      height: auto !important;
      max-height: none !important;
    }
    
    body {
      background: #F9F1DC;
      overflow: hidden auto !important;
      margin: 0 !important;
      padding: 0 !important;
      height: auto !important;
      max-height: none !important;
      width: 100% !important;
    }
    
    *, *::before, *::after {
      box-sizing: border-box;
    }
    
    /* גלילה תקינה */
    html {
      overflow-x: hidden !important;
      overflow-y: auto !important;
      height: 100% !important;
      width: 100% !important;
      max-width: 100vw !important;
    }
    
    body {
      overflow-x: hidden !important;
      overflow-y: auto !important;
      height: 100% !important;
      width: 100% !important;
      max-width: 100vw !important;
    }
    
    .body-center {
      direction: rtl !important;
      width: 100% !important;
      height: auto !important;
      max-height: none !important;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      overflow-x: hidden;
    }
    
    @media (max-width: 700px) {
      html, body {
        -webkit-overflow-scrolling: touch !important;
      }
      
      * {
        -webkit-overflow-scrolling: touch !important;
        box-sizing: border-box !important;
      }
    }
    /* Header */
    header {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      padding: 8px 10px;
      position: relative;
      width: 100%;
      max-width: 100vw;
      height: 90px;
      background: transparent;
      isolation: isolate;
      box-sizing: border-box;
    }
    .logo {
      width: 180px;
      height: 80px;
      background: url('logo.jpg') no-repeat center/cover;
      transform: rotate(0.67deg);
      z-index: 0;
    }
    .cart {
      position: absolute;
      width: 32px;
      height: 32px;
      right: 10px;
      top: 10px;
      z-index: 1;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .cart-icon {
      width: 32px;
      height: 32px;
      background: url('shop.svg') no-repeat center center;
      background-size: contain;
      background-color: transparent;
      position: relative;
    }
    .cart-badge {
      position: absolute;
      left: 50%;
      bottom: 3px;
      top: auto;
      transform: translateX(-50%);
      color: #111;
      font-size: 18px;
      font-family: 'Rubik', sans-serif;
      font-weight: bold;
      background: none;
      border: none;
      width: auto;
      height: auto;
      line-height: 1;
      display: block;
      z-index: 2;
      pointer-events: none;
    }

    /* Side Cart Styles */
    .cart-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.25);
      z-index: 99;
      transition: opacity 0.3s;
    }
    .cart-overlay.active {
      display: block;
      opacity: 1;
    }
    .side-cart {
      position: fixed;
      top: 0;
      right: -100%;
      width: 370px;
      max-width: 90vw;
      height: 100vh;
      background: #fff;
      box-shadow: -2px 0 16px #0002;
      z-index: 100;
      transform: translateX(100%);
      transition: all 0.35s cubic-bezier(.7,.2,.2,1);
      display: flex;
      flex-direction: column;
      padding: 0;
      visibility: hidden;
      opacity: 0;
      pointer-events: none;
    }
    .side-cart.active {
      right: 0;
      transform: translateX(0);
      visibility: visible;
      opacity: 1;
      pointer-events: auto;
    }
    
    /* Cart Item Highlight Animation */
    @keyframes highlightItem {
      0% { background-color: transparent; }
      25% { background-color: rgba(186, 134, 99, 0.2); }
      75% { background-color: rgba(186, 134, 99, 0.2); }
      100% { background-color: transparent; }
    }
    
    .cart-item.highlight {
      animation: highlightItem 2s ease-in-out;
    }
    
    .side-cart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 18px 20px 10px 20px;
      border-bottom: 1px solid #eee;
      background: #BA8663;
    }
    .side-cart-title {
      font-family: 'Amatica SC', cursive;
      font-size: 32px;
      font-weight: 700;
      color: #fff;
    }
    .side-cart-close {
      background: none;
      border: none;
      font-size: 32px;
      color: #775A47;
      cursor: pointer;
      font-family: inherit;
      line-height: 1;
    }
    .side-cart-list {
      flex: 1;
      overflow-y: auto;
      padding: 10px 0 0 0;
      background: #fff;
    }
    .side-cart-item {
      display: flex;
      align-items: flex-start;
      justify-content: flex-start;
      background: #F9F1DC;
      border-radius: 8px;
      margin: 0 16px 12px 16px;
      padding: 10px 10px 10px 6px;
      box-shadow: 0 1px 4px #0001;
      position: relative;
      min-height: 60px;
      user-select: none;
      overflow: hidden;
    }
    .side-cart-item-header {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 12px;
      width: 100%;
      height: 70px;
      min-height: 70px;
    }
    .side-cart-item-title-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      flex: 1;
      margin: 0;
      padding: 0;
      min-width: 0;
    }
    .side-cart-item-title-main, .side-cart-item-title-sub {
      font-size: 20px;
      font-weight: 800;
      color: #775A47;
      font-family: 'Amatica SC', cursive;
      line-height: 1.08;
      text-align: center;
      margin: 0;
      padding: 0;
      max-width: 90px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .side-cart-item-title-sub {
      font-weight: 800;
      margin-top: 0;
      margin-bottom: 0;
    }
    .side-cart-item-qty {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 400;
      color: #BA8663;
      width: 32px;
      height: 22px;
      background: #f6eee0;
      border-radius: 8px;
      text-align: center;
      margin: 0;
      font-family: 'Amatica SC', cursive;
    }
    .side-cart-item-details {
      margin: 6px 0 0 0;
      padding: 0;
      width: 100%;
    }
    .side-cart-item-details-list {
      list-style: none;
      margin: 0;
      padding: 0;
      text-align: right;
      max-width: 100%;
      overflow: hidden;
    }
    .side-cart-item-details-list li {
      font-size: 15px;
      color: #5C4638;
      background: none;
      border-radius: 0;
      margin-bottom: 0;
      padding: 0;
      font-family: 'Amatica SC', cursive;
      font-weight: 700;
      direction: rtl;
      line-height: 1.5;
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .side-cart-item-details-label {
      color: #5EA189;
      font-weight: bold;
      flex-shrink: 0;
      text-align: right;
    }
    .side-cart-item-details-value {
      flex: 1;
      min-width: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .side-cart-item-color-box {
      display: inline-block;
      width: 11px;
      height: 11px;
      border-radius: 2px;
      border: 1px solid #ccc;
      margin-left: 4px;
      vertical-align: middle;
      align-self: center;
    }
    .side-cart-item-actions {
      position: absolute;
      left: 8px;
      bottom: 6px;
      display: flex;
      flex-direction: row;
      gap: 6px;
      z-index: 2;
    }
    .side-cart-item-trash-btn, .side-cart-item-add-btn {
      background: none;
      border: none;
      padding: 0;
      margin: 0;
      cursor: pointer;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.7;
      transition: opacity 0.2s;
    }
    .side-cart-item-trash-btn:hover, .side-cart-item-add-btn:hover {
      opacity: 1;
    }
    .side-cart-item-trash-icon {
      width: 20px;
      height: 20px;
      background: url('trash.svg') no-repeat center/contain;
      display: inline-block;
    }
    .side-cart-item-plus-icon {
      font-size: 20px;
      font-weight: bold;
      color: #5EA189;
      display: inline-block;
      line-height: 1;
    }

    .side-cart-view-btn {
      width: 90%;
      margin: 16px auto 18px auto;
      height: 48px;
      background: #5EA189;
      color: #fff;
      font-family: 'Amatica SC', cursive;
      font-size: 24px;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
      display: block;
    }
    .side-cart-view-btn:hover {
      background: #4b8c74;
    }
    /* Cart Delete Dialog */
    .cart-delete-dialog {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.18);
      z-index: 200;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .cart-delete-dialog-content {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 16px #0003;
      padding: 32px 28px 18px 28px;
      min-width: 260px;
      text-align: center;
    }
    .cart-delete-dialog-title {
      font-family: 'Amatica SC', cursive;
      font-size: 22px;
      color: #775A47;
      margin-bottom: 18px;
    }
    .cart-delete-dialog-actions {
      display: flex;
      justify-content: center;
      gap: 18px;
    }
    .cart-delete-btn-yes {
      background: #e74c3c;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      font-family: 'Amatica SC', cursive;
      padding: 6px 22px;
      cursor: pointer;
    }
    .cart-delete-btn-no {
      background: #eee;
      color: #775A47;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      font-family: 'Amatica SC', cursive;
      padding: 6px 22px;
      cursor: pointer;
    }
    @media (max-width: 700px) {
      /* Mobile Header */
      header {
        height: 70px;
        padding: 6px 8px;
        margin-top: 0 !important;
      }
      
      .logo {
        width: 140px;
        height: 60px;
      }
      
      nav {
        margin-top: 0 !important;
        margin-top: 10px !important;
      }
      
      .cart {
        width: 28px;
        height: 28px;
        right: 8px;
        top: 8px;
      }
      
      .cart-icon {
        width: 28px;
        height: 28px;
      }
      
      .cart-badge {
        font-size: 14px;
        bottom: 2px;
      }
      
      /* Mobile Navigation */
      nav {
        height: 40px;
        padding: 0 2vw;
        gap: 15px;
        overflow-x: auto;
        overflow-y: hidden;
        white-space: nowrap;
        margin-bottom: 15px;
      }
      
      .nav-link {
        font-size: 24px;
        line-height: 40px;
        height: 40px;
        min-width: 50px;
        margin: 0 1vw;
        white-space: nowrap;
        flex-shrink: 0;
      }

      /* Mobile Record specific */
      .record-main {
        width: 100%;
        padding: 0;
        margin: 0;
      }

      .record-title {
        font-size: 60px;
        margin-bottom: 20px !important;
        margin-top: 0 !important;
      }
      
      .record-container {
        flex-direction: column-reverse;
        max-width: 100%;
        width: 100%;
        align-items: center;
        margin: 0 !important;
        padding: 0;
        gap: 20px !important;
      }
      
      .record-form {
        min-width: unset;
        width: 100%;
        padding: 16px 14px !important;
        border-radius: 16px;
      }
      
      .record-gallery {
        min-width: unset;
        width: 100%;
      }
      
      .record-gallery-row {
        gap: 18px;
      }
      
      .record-main-img {
        width: 90vw;
        max-width: 320px;
        height: auto;
        aspect-ratio: 1/1;
      }
      
      .record-note {
        text-align: right;
        padding: 0;
        margin: 20px 0 0 0;
        font-size: 24px;
        width: 100%;
      }
      
      /* Mobile Footer */
      footer {
        height: auto;
        min-height: 120px;
        flex-direction: column;
        align-items: center;
        text-align: center;
        padding: 15px 10px;
      }
      
      .footer-nav {
        position: static;
        transform: none;
        left: auto;
        top: auto;
        margin: 10px 0;
        flex-wrap: wrap;
        gap: 15px;
      }
      
      .footer-link {
        font-size: 18px;
      }
      
      .footer-contact {
        position: static;
        align-items: center;
        margin: 10px 0;
      }
      
      .footer-contact-text {
        font-size: 14px;
      }
      
      .footer-logo {
        width: 70px;
        height: 70px;
        margin: 10px 0;
      }
      
      /* Mobile Shop Popup */
      .shop-popup {
        top: 100%;
        right: 0;
        left: auto;
        min-width: 140px;
        font-size: 18px;
      }
      
      .shop-popup > ul > li {
        padding: 0 8px;
        margin-bottom: 0;
      }
      
      .shop-popup a, .shop-popup .popup-main-btn {
        font-size: 18px;
        padding: 2px 0;
        line-height: 1.2;
      }
      
      .popup-sub {
        right: 100%;
        min-width: 100px;
        font-size: 16px;
      }
      
      .popup-sub a {
        font-size: 16px;
        padding: 2px 0;
      }
    }

    /* Navigation Bar */
    nav {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: center;
      padding: 0 5vw;
      gap: 30px;
      width: 100%;
      max-width: 100vw;
      height: 44px;
      background: #BA8663;
      margin-bottom: 20px;
      box-sizing: border-box;
    }
    .nav-link {
      width: auto;
      min-width: 65px;
      height: 48px;
      font-family: 'Amatica SC', cursive;
      font-weight: 700;
      font-size: 32px;
      line-height: 48px;
      display: flex;
      align-items: center;
      text-align: center;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: #fff;
      margin: 0 2vw;
      transform: rotate(0.52deg);
      background: transparent;
      cursor: pointer;
      text-decoration: none;
      justify-content: center;
    }
    /* --- Shop Popup refined styles --- */
    .shop-popup {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      left: auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 12px #0002;
      z-index: 100;
      min-width: 140px;
      padding: 4px 0;
      font-family: 'Amatica SC', cursive;
      font-size: 18px;
      color: #5C4638;
      direction: rtl;
    }
    .shop-popup ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .shop-popup > ul > li {
      padding: 0 10px;
      margin-bottom: 1px;
      position: relative;
    }
    .shop-popup a, .shop-popup .popup-main-btn {
      color: #5C4638;
      text-decoration: none;
      background: none;
      border: none;
      font: inherit;
      cursor: pointer;
      padding: 2px 0;
      width: 100%;
      text-align: right;
      display: block;
      border-radius: 6px;
      transition: background 0.2s;
      line-height: 1.2;
      font-size: 18px;
    }
    .shop-popup a:hover, .shop-popup .popup-main-btn:hover {
      background: #f9f1dc;
    }
    .popup-sub {
      display: none;
      position: absolute;
      right: 100%;
      top: 0;
      background: #f6eee0;
      border-radius: 8px;
      box-shadow: 0 2px 8px #0001;
      padding: 2px 0;
      min-width: 110px;
      z-index: 101;
    }
    .popup-sub li {
      margin-bottom: 0;
      padding: 0 6px;
    }
    .popup-sub a {
      font-size: 15px;
      line-height: 1.2;
      padding: 2px 0;
    }
    .shop-popup .active + .popup-sub {
      display: block;
    }
    .shop-popup-btn {
      border: none !important;
      outline: none !important;
      box-shadow: none !important;
      background: transparent;
    }
    /* --- פופאפ חנות בפוטר --- */
    .footer-link-shop-popup {
      position: relative;
    }
    .footer-shop-popup {
      display: none;
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 12px #0002;
      z-index: 200;
      min-width: 140px;
      padding: 4px 0;
      font-family: 'Amatica SC', cursive;
      font-size: 18px;
      color: #5C4638;
      direction: rtl;
    }
    /* Footer Section */
    footer {
      display: flex;
      flex-direction: row-reverse;
      justify-content: space-between;
      align-items: flex-start;
      background: #5C4638;
      padding: 10px 16px;
      box-sizing: border-box;
      height: 120px;
      direction: rtl;
      position: relative;
    }
    .footer-content {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 100%;
    }
    .footer-nav {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-right: auto;
      margin-left: auto;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      right: auto;
      top: 10px;
    }
    .footer-link {
      font-family: 'Amatica SC', cursive;
      font-weight: 700;
      font-size: 22px;
      color: white;
      text-decoration: none;
    }
    .footer-sep {
      font-size: 20px;
      color: white;
    }
    .footer-contact {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
      position: absolute;
      bottom: 10px;
      left: 16px;
    }
    .footer-contact-item {
      display: flex;
      flex-direction: row-reverse;
      align-items: center;
      gap: 10px;
    }
    .footer-icon {
      width: 18px;
      height: 18px;
    }
    .footer-contact-text {
      font-family: 'Amatica SC', cursive;
      font-weight: 700;
      font-size: 18px;
      color: white;
    }
    .footer-logo {
      width: 90px;
      height: 90px;
      background: url('logo.jpg') no-repeat center/contain;
      border-radius: 12px;
    }
    .copyright-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0;
      gap: 2px;
      width: 100%;
      max-width: 100vw;
      height: 20px;
      background: transparent;
      margin-top: 2px;
      box-sizing: border-box;
    }
    .copyright-text {
      width: 180px;
      height: 20px;
      font-family: 'Amatica SC', cursive;
      font-weight: 700;
      font-size: 16px;
      color: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }
    @media (max-width: 700px) {
      header {
        height: 120px;
      }
      .logo {
        width: 140px;
        height: 60px;
      }
      nav {
        height: 38px;
      }
      .nav-link {
        font-size: 22px;
        height: 38px;
        line-height: 38px;
      }
      .footer-logo {
        width: 60px;
        height: 60px;
      }
      footer {
        height: 80px;
        padding: 6px 6px;
      }
      .footer-link, .footer-sep {
        font-size: 14px;
      }
      .footer-contact-text {
        font-size: 12px;
      }
      .footer-icon {
        width: 12px;
        height: 12px;
      }
      .copyright-text {
        font-size: 16px;
        width: 140px;
        height: auto;
        padding: 5px 0;
      }
    }
    /* --- CSS ייחודי של החלק המרכזי (הטופס, הגלריה וכו') --- */
    .record-title {
      font-family: 'Amatica SC', cursive;
      font-size: 90px;
      font-weight: 900;
      color: #775a47;
      margin-bottom: 25px !important;
      margin-top: 0 !important;
      letter-spacing: 0.08em;
      line-height: 1;
      text-align: center;
      text-shadow: 0 2px 0 #775a47;
      width: 100%;
    }

    .record-main {
      margin-bottom: 0 !important;
      padding-top: 0 !important;
      min-height: 500px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: flex-start;
      width: 100%;
      position: relative;
      padding: 0;
    }

    .record-container {
      margin-bottom: 0 !important;
      max-width: 480px;
      margin: 0 !important;
      display: flex;
      flex-direction: row-reverse;
      gap: 40px;
      justify-content: flex-start;
      align-items: center;
      padding: 0;
      width: 100%;
    }

    .record-note {
      font-family: 'Amatica SC', cursive;
      font-size: 28px;
      color: #775A47;
      text-align: right;
      margin-top: 25px;
      line-height: 1.2;
      padding: 0;
      width: 100%;
      max-width: none;
      margin: 25px 0 0 0;
    }

    .record-main-img {
      width: 100%;
      max-width: 800px;
      height: auto;
      margin-bottom: 15px !important;
      border-radius: 8px;
      box-shadow: 0 2px 12px #0002;
      order: unset !important;
    }

    .record-form {
      width: 100%;
      max-width: 800px;
      display: flex;
      flex-direction: column;
      gap: 15px !important;
      padding: 16px 14px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 12px #0002;
      min-width: unset !important;
    }

    @media (max-width: 900px) {
      .record-title {
        font-size: 60px;
        margin-bottom: 20px !important;
        margin-top: 0 !important;
      }
      
      .record-main {
        padding: 0;
        margin-bottom: 5px !important;
      }

      .record-container {
        flex-direction: column;
        align-items: center;
        gap: 20px;
        padding: 0 15px;
        margin: 0 auto !important;
      }
      
      .record-gallery {
        height: auto;
        min-width: unset;
        width: 100%;
        max-width: 400px;
        display: flex;
        flex-direction: column;
      }
      
      .record-gallery-row {
        flex-direction: column;
        align-items: center;
        height: auto;
        width: 100%;
        gap: 20px;
      }
      
      .record-thumbs-col {
        order: -1;
        flex-direction: row;
        justify-content: center;
        gap: 12px;
        margin-bottom: 20px;
        width: 100%;
      }
      
      .record-thumb {
        width: 60px;
        height: 60px;
      }
      
      .record-main-img {
        width: 90vw;
        max-width: 320px;
        height: auto;
        aspect-ratio: 1/1;
        margin: 0 auto 15px auto !important;
      }
      
      .record-note {
        padding: 0 20px;
        text-align: center;
        margin: 40px auto;
        max-width: 600px;
        font-size: 24px;
      }
      
      .record-form {
        padding: 16px 14px;
        gap: 12px !important;
        width: 100%;
      }
    }
    .record-gallery {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-width: 350px;
      width: 350px;
      min-height: auto !important;
      height: 100%;
      position: relative;
    }
    .record-gallery-row {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 18px;
      height: 320px;
      width: 100%;
      position: relative;
    }
    .record-thumbs-col {
      display: flex;
      flex-direction: column;
      gap: 8px;
      order: 0;
    }

    .record-thumb {
      width: 48px;
      height: 48px;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid #222;
      cursor: pointer;
      background: #2222;
      transition: border 0.2s;
    }

    .record-thumb:hover {
      border-color: #BA8663;
    }

    .record-thumb.selected {
      border: 1px solid #f3b586;
      box-shadow: 0 0 8px rgba(255, 107, 107, 0.6);
      transform: scale(1.05);
    }

    .record-note {
      font-family: 'Amatica SC', cursive;
      font-size: 28px;
      color: #775A47;
      text-align: right;
      margin-top: 25px;
      line-height: 1.2;
      padding-right: 40px;
      width: 100%;
      max-width: 1200px;
    }

    /* Mobile responsive styles */
    @media (max-width: 900px) {
      .record-thumbs-col {
        flex-direction: row;
        gap: 8px;
        margin-top: 10px;
        justify-content: center;
        order: 2;
      }

      .record-note {
        text-align: center;
        padding-right: 0;
        padding: 0 15px;
        margin-top: 20px;
        font-size: 24px;
      }
    }
    .record-main-img {
      width: 320px !important;
      height: 320px !important;
      max-width: 320px !important;
      aspect-ratio: 1/1;
      object-fit: cover;
      border-radius: 16px;
      border: 3px solid #222;
      background: #2222;
      margin-bottom: 0;
      display: block;
      order: 1;
      align-self: center;
    }
    .record-form {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
      min-width: 400px;
      background: #e2c9a6;
      padding: 16px 14px;
      border-radius: 16px;
      box-shadow: 0 2px 12px #0001;
      position: relative;
    }
    .record-label {
      font-family: 'Amatica SC', cursive;
      font-size: 32px;
      color: #5C4638;
      margin-bottom: 4px;
    }
    .record-color-row {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
      width: 100%;
    }
    .record-color-input {
      width: 120px;
      font-size: 22px;
      border: 2px solid #BA8663;
      border-radius: 6px;
      padding: 6px 8px;
      font-family: 'Amatica SC', cursive;
      background: #f9f1dc;
    }
    .record-textarea {
      width: 100%;
      min-width: 100%;
      max-width: 100%;
      height: 120px;
      border-radius: 8px;
      border: 2px solid #BA8663;
      font-size: 22px;
      padding: 10px;
      font-family: 'Amatica SC', cursive;
      resize: vertical;
      background: #f9f1dc;
      margin-bottom: 10px;
      box-sizing: border-box;
    }
    .record-file-upload-row {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 10px;
      width: 100%;
      justify-content: flex-start;
    }
    .record-file-icon {
      cursor: pointer;
      display: flex;
      align-items: center;
      margin-right: auto;
      margin-left: 0;
    }
    .record-file-name {
      font-size: 18px;
      color: #5C4638;
      direction: ltr;
      max-width: 180px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      margin-left: 10px;
      margin-right: 10px;
    }
    .record-qty-row {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 12px;
      margin: 10px 0;
      width: 100%;
    }
    .record-qty-input {
      width: 80px;
      font-size: 22px;
      border: 2px solid #BA8663;
      border-radius: 6px;
      padding: 6px 8px;
      font-family: 'Amatica SC', cursive;
      background: #f9f1dc;
      text-align: center;
    }
    .record-qty-input::-webkit-inner-spin-button,
    .record-qty-input::-webkit-outer-spin-button {
      opacity: 1;
      margin-left: 8px;
    }
    .record-btn-row {
      width: 100%;
      display: flex;
      justify-content: center;
      margin-top: 18px;
    }
    .record-add-btn {
      width: 220px;
      height: 60px;
      background: #7bb39b;
      color: #fff;
      font-family: 'Amatica SC', cursive;
      font-size: 36px;
      border: 3px solid #fff;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .record-add-btn:hover {
      background: #5C4638;
      color: #fff;
    }
    .record-note {
      font-size: 16px;
      color: #000;
      opacity: 0.7;
      text-align: right;
      font-family: 'Amatica SC', cursive;
      margin: 40px 0 30px 0;
      line-height: 1.5;
      position: static;
      width: 100%;
      max-width: 1200px;
      padding-right: 40px;
    }
    @media (max-width: 900px) {
      .record-container {
        flex-direction: column;
        align-items: center;
        gap: 20px;
        padding: 0 15px;
      }
      
      .record-gallery {
        height: auto;
        min-width: unset;
        width: 100%;
        max-width: 400px;
        display: flex;
        flex-direction: column;
      }
      
      .record-gallery-row {
        flex-direction: column;
        align-items: center;
        height: auto;
        width: 100%;
        gap: 20px;
      }
      
      .record-thumbs-col {
        order: -1;
        flex-direction: row;
        justify-content: center;
        gap: 12px;
        margin-bottom: 20px;
        width: 100%;
      }
      
      .record-thumb {
        width: 60px;
        height: 60px;
      }
      
      .record-main-img {
        width: 90vw;
        max-width: 320px;
        height: auto;
        aspect-ratio: 1/1;
        margin: 0 auto;
      }
      
      .record-note {
        padding: 0 20px;
        text-align: center;
        margin: 40px auto;
        max-width: 600px;
        font-size: 24px;
      }
    }
    input[type="color"] {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 2px solid #BA8663;
      padding: 0;
      box-sizing: border-box;
      cursor: pointer;
      margin-right: 12px;
      background: #5C4638;
      -webkit-appearance: none;
      appearance: none;
    }
    
    input[type="color"]::-webkit-color-swatch-wrapper {
      padding: 0;
      border-radius: 50%;
      border: none;
    }
    
    input[type="color"]::-webkit-color-swatch {
      border-radius: 50%;
      border: none;
      padding: 0;
    }
    
    input[type="color"]::-moz-color-swatch {
      border-radius: 50%;
      border: none;
      background: #5C4638;
      padding: 0;
    }
    
    input[type="color"]::-ms-color-swatch {
      border-radius: 50%;
      border: none;
      background: #5C4638;
      padding: 0;
    }

    
    /* Media queries for mobile devices */
    @media (max-width: 768px) {
      input[type="color"] {
        width: 48px;
        height: 48px;
        border: 2px solid #BA8663;
        margin-right: 12px;
        background: #5C4638;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        -webkit-appearance: none;
        appearance: none;
      }
      
      input[type="color"]::-webkit-color-swatch-wrapper {
        padding: 0;
        border-radius: 50%;
        border: none;
      }
      
      input[type="color"]::-webkit-color-swatch {
        border-radius: 50%;
        border: none;
        padding: 0;
      }
      
      input[type="color"]::-moz-color-swatch {
        border-radius: 50%;
        border: none;
        background: #5C4638;
        padding: 0;
      }
      
      input[type="color"]::-ms-color-swatch {
        border-radius: 50%;
        border: none;
        background: #5C4638;
        padding: 0;
      }
    }
    
    @media (max-width: 480px) {
      input[type="color"] {
        width: 48px;
        height: 48px;
        border: 2px solid #BA8663;
        margin-right: 12px;
        background: #5C4638;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        -webkit-appearance: none;
        appearance: none;
      }
      
      input[type="color"]::-webkit-color-swatch-wrapper {
        padding: 0;
        border-radius: 50%;
        border: none;
      }
      
      input[type="color"]::-webkit-color-swatch {
        border-radius: 50%;
        border: none;
        padding: 0;
      }
      
      input[type="color"]::-moz-color-swatch {
        border-radius: 50%;
        border: none;
        background: #5C4638;
        padding: 0;
      }
      
      input[type="color"]::-ms-color-swatch {
        border-radius: 50%;
        border: none;
        background: #5C4638;
        padding: 0;
      }
      
      /* Additional mobile improvements */
      .color-input-group {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        flex-wrap: wrap;
      }
      
      .color-input-group label {
        font-size: 16px;
        margin-bottom: 8px;
        width: 100%;
      }
      
      .color-input-group input[type="text"] {
        width: 120px;
        margin-right: 10px;
      }
      
      /* Ensure color swatches are visible on mobile */

    }
    
    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background-color: #7bb39b;
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      font-family: 'Amatica SC', cursive;
      font-size: 24px;
      opacity: 0;
      transition: all 0.3s ease-in-out;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    .error-message {
      color: red;
      font-family: 'Amatica SC', cursive;
      font-size: 18px;
      margin-top: 4px;
      display: none;
    }

    .record-form input.error, .record-form textarea.error {
      border-color: red;
    }

    .record-file-icon.error img {
      filter: invert(27%) sepia(51%) saturate(7471%) hue-rotate(356deg) brightness(97%) contrast(115%);
    }
    .file-upload-container {
      width: calc(100% - 30px);
      max-width: 400px;
      border: 2px solid #BA8663;
      border-radius: 12px;
      padding: 6px 12px;
      text-align: center;
      background: #f9f1dc;
      position: relative;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 0 0 10px 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 65px;
    }
    .file-upload-container:hover {
      border-color: #7bb39b;
    }
    .file-upload-container.dragover {
      border-color: #7bb39b;
    }
    .file-upload-container.error {
      border-color: #ff4444 !important;
      background: #f9f1dc !important;
    }
    .file-preview-container {
      display: grid;
      grid-template-columns: repeat(4, 85px);
      gap: 8px;
      margin: 8px 0 0 25px;
      padding: 0;
      width: calc(100% - 25px);
      max-width: 400px;
    }
    .file-preview-item {
      position: relative;
      width: 85px;
      height: 85px;
      border-radius: 8px;
      overflow: hidden;
      background: #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .file-preview-item:hover {
      box-shadow: 0 3px 8px rgba(0,0,0,0.15);
    }
    .file-preview-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .file-preview-item .pdf-preview {
      width: 100%;
      height: 100%;
      background: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 15px;
    }
    .file-preview-item .pdf-icon {
      width: 35px;
      height: 35px;
      margin-bottom: 8px;
    }
    .file-preview-item .file-name {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 4px 6px;
      font-size: 11px;
      text-align: center;
      direction: ltr;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .file-preview-item .remove-file {
      position: absolute;
      top: 4px;
      right: 4px;
      width: 20px;
      height: 20px;
      background: rgba(255,255,255,0.9);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: #666;
      font-size: 16px;
      line-height: 1;
      z-index: 2;
      transition: all 0.2s ease;
    }
    .file-preview-item .remove-file:hover {
      background: #ff4444;
      color: white;
    }
    .file-error-message {
      color: #ff4444;
      font-family: 'Amatica SC', cursive;
      font-size: 18px;
      font-weight: 700;
      margin: 5px 0 0 30px;
      display: none;
      background: rgba(255, 68, 68, 0.1);
      padding: 4px 12px;
      border-radius: 6px;
      width: fit-content;
    }
    .file-upload-icon {
      width: 32px;
      height: 32px;
      margin: 0 auto 8px;
      opacity: 0.8;
    }
    .file-upload-text {
      font-family: 'Amatica SC', cursive;
      font-size: 22px;
      color: #999;
      margin: 0;
      font-weight: 700;
      line-height: 1;
    }
    .file-upload-subtext {
      font-family: 'Amatica SC', cursive;
      font-size: 16px;
      color: #999;
      font-weight: 700;
      display: flex;
      flex-wrap: wrap;
      gap: 2px;
      justify-content: center;
      align-items: center;
      margin-top: 2px;
      line-height: 1;
    }
    .file-type-icon {
      display: inline-block;
      padding: 2px 6px;
      margin: 0 2px;
      background: rgba(153, 153, 153, 0.1);
      border-radius: 3px;
      color: #999;
      font-size: 14px;
      font-family: 'Amatica SC', cursive;
      font-weight: 700;
    }
    
    /* Mobile responsive styles */
    @media (max-width: 700px) {
      /* Mobile Header */
      header {
        height: 70px;
        padding: 6px 8px;
      }
      
      .logo {
        width: 140px;
        height: 60px;
      }
      
      nav {
        margin-top: 0 !important;
        margin-bottom: 10px !important;
      }
      
      .cart {
        width: 28px;
        height: 28px;
        right: 8px;
        top: 8px;
      }
      
      .cart-icon {
        width: 28px;
        height: 28px;
      }
      
      .cart-badge {
        font-size: 14px;
        bottom: 2px;
      }
      
      /* Mobile Side Cart */
      .side-cart {
        width: 98vw;
        max-width: 98vw;
      }
      
      /* Ensure the view cart button is always visible on mobile */
      .side-cart-view-btn {
        position: sticky;
        bottom: 0;
        width: calc(100% - 32px);
        margin: 16px 16px 18px 16px;
        height: 48px;
        background: #5EA189;
        color: #fff;
        font-family: 'Amatica SC', cursive;
        font-size: 20px;
        font-weight: 700;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.2s;
        display: block;
        z-index: 10;
        box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
      }
      
      .side-cart-view-btn:hover {
        background: #4b8c74;
      }
      
      /* Adjust side-cart-list padding to prevent overlap */
      .side-cart-list {
        padding: 10px 0 80px 0;
      }
      
      /* Tablet styles for medium screens */
      @media (min-width: 701px) and (max-width: 1024px) {
        .side-cart-view-btn {
          position: sticky;
          bottom: 0;
          width: calc(100% - 32px);
          margin: 16px 16px 25px 16px;
          height: 48px;
          background: #5EA189;
          color: #fff;
          font-family: 'Amatica SC', cursive;
          font-size: 20px;
          font-weight: 700;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          transition: background 0.2s;
          display: block !important;
          z-index: 10;
          box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
        }
        
        .side-cart-view-btn:hover {
          background: #4b8c74;
        }
        
        /* Adjust side-cart-list padding to prevent overlap */
        .side-cart-list {
          padding: 10px 0 100px 0;
        }
      }
      
      /* iPad and Safari specific fixes */
      @media only screen and (min-device-width: 768px) and (max-device-width: 1024px) and (-webkit-min-device-pixel-ratio: 1) {
        .side-cart-view-btn {
          position: sticky !important;
          bottom: 0 !important;
          z-index: 9999 !important;
          -webkit-transform: none !important;
          transform: none !important;
          display: block !important;
          visibility: visible !important;
          opacity: 1 !important;
        }
        
        .side-cart-list {
          padding: 10px 0 120px 0;
        }
      }
      
      /* Safari specific fixes */
      @media screen and (-webkit-min-device-pixel-ratio: 0) {
        .side-cart-view-btn {
          position: sticky !important;
          bottom: 0 !important;
          z-index: 9999 !important;
          -webkit-transform: none !important;
          transform: none !important;
          display: block !important;
          visibility: visible !important;
          opacity: 1 !important;
        }
      }
      
      /* iOS Safari specific fixes */
      @supports (-webkit-touch-callout: none) {
        .side-cart-view-btn {
          position: sticky !important;
          bottom: 0 !important;
          z-index: 9999 !important;
          -webkit-transform: none !important;
          transform: none !important;
          display: block !important;
          visibility: visible !important;
          opacity: 1 !important;
        }
      }
      
      /* Mobile Navigation */
      nav {
        height: 40px;
        padding: 0 2vw;
        gap: 15px;
        overflow-x: auto;
        overflow-y: hidden;
        white-space: nowrap;
        margin-bottom: 15px;
      }
      
      .nav-link {
        font-size: 24px;
        line-height: 40px;
        height: 40px;
        min-width: 50px;
        margin: 0 1vw;
        white-space: nowrap;
        flex-shrink: 0;
      }

      /* Mobile Record specific */
      .record-main {
        width: 100%;
        padding: 0;
        margin: 0;
      }

      .record-title {
        font-size: 60px;
        margin-bottom: 20px !important;
        margin-top: 0 !important;
      }
      
      .record-container {
        flex-direction: column-reverse;
        max-width: 100%;
        width: 100%;
        align-items: center;
        margin: 0 !important;
        padding: 0;
        gap: 20px !important;
      }
      
      .record-form {
        min-width: unset;
        width: 100%;
        padding: 16px 14px !important;
        border-radius: 16px;
      }
      
      .record-gallery {
        min-width: unset;
        width: 100%;
      }
      
      .record-gallery-row {
        gap: 18px;
      }
      
      .record-main-img {
        width: 90vw;
        max-width: 320px;
        height: auto;
        aspect-ratio: 1/1;
      }
      
      .record-note {
        text-align: right;
        padding: 0;
        margin: 20px 0 0 0;
        font-size: 24px;
        width: 100%;
      }
      
      /* Mobile Footer */
      footer {
        height: auto;
        min-height: 120px;
        flex-direction: column;
        align-items: center;
        text-align: center;
        padding: 15px 10px;
      }
      
      .footer-nav {
        position: static;
        transform: none;
        left: auto;
        top: auto;
        margin: 10px 0;
        flex-wrap: wrap;
        gap: 15px;
      }
      
      .footer-link {
        font-size: 18px;
      }
      
      .footer-contact {
        position: static;
        align-items: center;
        margin: 10px 0;
      }
      
      .footer-contact-text {
        font-size: 14px;
      }
      
      .footer-logo {
        width: 70px;
        height: 70px;
        margin: 10px 0;
      }
      
      /* Additional mobile styles for very small screens */
      @media (max-width: 480px) {
        .side-cart-view-btn {
          font-size: 18px;
          height: 44px;
          margin: 12px 12px 16px 12px;
          width: calc(100% - 24px);
        }
      }
      
      /* Additional mobile styles for very small screens */
      @media (max-width: 480px) {
        .side-cart-view-btn {
          font-size: 18px;
          height: 44px;
          margin: 12px 12px 16px 12px;
          width: calc(100% - 24px);
        }
      }
      
      /* Mobile Shop Popup */
      .shop-popup {
        top: 100%;
        right: 0;
        left: auto;
        min-width: 140px;
        font-size: 18px;
      }
      
      .shop-popup > ul > li {
        padding: 0 8px;
        margin-bottom: 0;
      }
      
      .shop-popup a, .shop-popup .popup-main-btn {
        font-size: 18px;
        padding: 2px 0;
        line-height: 1.2;
      }
      
      .popup-sub {
        right: 100%;
        min-width: 100px;
        font-size: 16px;
      }
      
      .popup-sub a {
        font-size: 16px;
        padding: 2px 0;
      }
    }

    /* Main Content */
    .matka-custom-title {
      font-family: 'Amatica SC', cursive;
      font-size: 54px;
      color: #775A47;
      text-align: center;
      margin-bottom: 28px !important;
      margin-top: 2px !important;
      width: 100%;
    }
    
    @media (max-width: 900px) {
      .matka-custom-title {
        font-size: 82px !important;
        margin-bottom: 25px !important;
        text-shadow: 0 3px 0 #775a47;
      }
    }

    .matka-custom-container {
      margin-bottom: 0 !important;
      max-width: 480px;
      margin: 0 auto !important;
      display: flex;
      flex-direction: row-reverse;
      gap: 40px;
      justify-content: center;
      align-items: center;
    }

    .matka-custom-form {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
      min-width: 400px;
      background: #e2c9a6;
      padding: 16px 14px !important;
      border-radius: 16px;
      box-shadow: 0 2px 12px #0001;
      position: relative;
    }

    /* Mobile responsive styles */
    @media (max-width: 900px) {
      .matka-custom-title {
        font-size: 54px !important;
        margin-bottom: 25px !important;
        margin-top: 0;
        text-shadow: none;
        font-weight: normal;
      }

      .matka-custom-container {
        flex-direction: column-reverse;
        max-width: 100%;
        width: 100%;
        align-items: center;
        margin: 0 !important;
        padding: 0;
        gap: 20px !important;
      }

      .matka-custom-form {
        min-width: unset;
        width: 100%;
        padding: 16px 14px !important;
        border-radius: 16px;
      }
    }

    /* Record Form Elements - Keep these for compatibility */
    .record-color-row {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
      width: 100%;
    }

    .record-label {
      font-family: 'Amatica SC', cursive;
      font-size: 32px;
      color: #5C4638;
      margin-bottom: 4px;
    }

    .record-color-input {
      width: 120px;
      font-size: 22px;
      border: 2px solid #BA8663;
      border-radius: 6px;
      padding: 6px 8px;
      font-family: 'Amatica SC', cursive;
      background: #f9f1dc;
    }

    .record-textarea {
      width: 100%;
      min-width: 100%;
      max-width: 100%;
      height: 120px;
      border-radius: 8px;
      border: 2px solid #BA8663;
      font-size: 22px;
      padding: 10px;
      font-family: 'Amatica SC', cursive;
      resize: vertical;
      background: #f9f1dc;
      margin-bottom: 10px;
      box-sizing: border-box;
    }

    .record-file-upload-row {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 10px;
      width: 100%;
      justify-content: flex-start;
    }

    .record-qty-row {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 12px;
      margin: 10px 0;
      width: 100%;
    }

    .record-qty-input {
      width: 80px;
      font-size: 22px;
      border: 2px solid #BA8663;
      border-radius: 6px;
      padding: 6px 8px;
      font-family: 'Amatica SC', cursive;
      background: #f9f1dc;
      text-align: center;
    }

    .record-btn-row {
      width: 100%;
      display: flex;
      justify-content: center;
      margin-top: 18px;
    }

    .record-add-btn {
      width: 220px;
      height: 60px;
      background: #7bb39b;
      color: #fff;
      font-family: 'Amatica SC', cursive;
      font-size: 36px;
      border: 3px solid #fff;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .record-add-btn:hover {
      background: #5C4638;
      color: #fff;
    }

    .record-gallery {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-width: 350px;
      width: 350px;
      min-height: 320px !important;
      height: auto !important;
      position: relative;
    }

    .record-gallery-row {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 18px;
      height: 320px;
      width: 100%;
      position: relative;
    }

    .record-thumbs-col {
      display: flex;
      flex-direction: column;
      gap: 8px;
      order: 0;
    }

    .record-thumb {
      width: 48px;
      height: 48px;
    }

    /* Mobile Layout Overrides */
    @media (max-width: 900px) {
      .record-container {
        flex-direction: column !important;
        max-width: 100%;
        width: 100%;
        align-items: center;
        margin: 0 auto !important;
        padding: 0 15px;
        gap: 30px !important;
      }
      
      .record-gallery {
        min-width: unset;
        width: 100%;
        max-width: 400px;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      
      .record-gallery-row {
        flex-direction: column;
        align-items: center;
        height: auto;
        width: 100%;
        gap: 20px;
      }
      
      .record-thumbs-col {
        order: -1;
        flex-direction: row !important;
        justify-content: center;
        gap: 12px;
        margin-bottom: 20px;
        width: 100%;
      }
      
      .record-thumb {
        width: 60px !important;
        height: 60px !important;
      }
      
      .record-main-img {
        width: 90vw;
        max-width: 320px;
        height: auto;
        aspect-ratio: 1/1;
        margin: 0 auto !important;
      }
      
      .record-note {
        text-align: center !important;
        padding: 0 20px;
        margin: 40px auto 60px auto !important;
        font-size: 18px;
        width: 100%;
        max-width: 600px;
        display: flex;
        justify-content: center;
        align-items: center;
        padding-right: 0;
        text-align: center;
        margin-top: 20px;
        margin-bottom: 20px;
      }
    }
    /* Mobile Layout Overrides */
    @media (max-width: 900px) {
      .record-title {
        font-size: 82px;
        margin-bottom: 25px !important;
        margin-top: 0 !important;
        text-shadow: 0 3px 0 #775a47;
      }
      
      .record-main {
        padding: 0;
        margin-bottom: 5px !important;
      }

      .record-container {
        flex-direction: column;
        align-items: center;
        gap: 20px;
        padding: 0 15px;
        margin: 0 auto !important;
      }
      
      .record-gallery {
        height: auto;
        min-width: unset;
        width: 100%;
        max-width: 400px;
        display: flex;
        flex-direction: column;
      }
      
      .record-gallery-row {
        flex-direction: column;
        align-items: center;
        height: auto;
        width: 100%;
        gap: 20px;
      }
      
      .record-thumbs-col {
        order: -1;
        flex-direction: row !important;
        justify-content: center;
        gap: 10px;
        margin-bottom: 12px;
        width: 100%;
      }
      
      .record-thumb {
        width: 45px !important;
        height: 45px !important;
      }
      
      .record-main-img {
        width: 90vw;
        max-width: 320px;
        height: auto;
        aspect-ratio: 1/1;
        margin: 0 auto 30px auto !important;
      }
      
      .record-note {
        text-align: center !important;
        padding: 0 20px;
        margin: 40px auto 60px auto !important;
        font-size: 18px;
        width: 100%;
        max-width: 600px;
        display: flex;
        justify-content: center;
        align-items: center;
      }
    }


  </style>
</head>
<body>
  <!-- Cart Overlay -->
  <div id="cartOverlay" class="cart-overlay"></div>
  
  <!-- Cart Delete Dialog -->
  <div class="cart-delete-dialog" id="cartDeleteDialog" style="display: none;">
    <div class="cart-delete-dialog-content">
      <div class="cart-delete-dialog-title">האם למחוק את המוצר מהעגלה?</div>
      <div class="cart-delete-dialog-actions">
        <button id="cartDeleteYes" class="cart-delete-btn-yes">כן</button>
        <button id="cartDeleteNo" class="cart-delete-btn-no">לא</button>
      </div>
    </div>
  </div>
  
  <aside id="sideCart" class="side-cart">
    <div class="side-cart-header">
      <span class="side-cart-title">סל קניות</span>
      <button class="side-cart-close" id="closeSideCart">×</button>
    </div>
    <div class="side-cart-list" id="sideCartList">
      <!-- כאן יתווספו המוצרים -->
    </div>
    <button class="side-cart-view-btn" id="viewCartBtn">לצפייה בסל הקניות</button>
  </aside>
  
  <!-- Toast Messages -->
  <div id="toast" class="toast">המוצר נוסף לסל בהצלחה!</div>
  <div id="cartError" class="toast" style="background-color: #ff4444;">לא ניתן לצפות בסל הקניות כרגע</div>

  <div class="body-center">
    <header>
      <div class="logo"></div>
      <div class="cart">
        <div class="cart-icon">
          <span class="cart-badge" id="cartBadge" style="display:none;">0</span>
        </div>
      </div>
    </header>
    <nav>
      <a class="nav-link" href="homepage.html">דף הבית</a>
      <button class="nav-link shop-popup-btn" id="shopPopupBtn" type="button">חנות</button>
      <a class="nav-link" href="policy.html">מדיניות</a>
      <a class="nav-link" href="contact.html">צור קשר</a>
    </nav>
    <!-- Popup (ממש אחרי ה-nav) -->
    <div class="shop-popup" id="shopPopup">
      <ul>
        <li><a href="shop.html">כללי</a></li>
        <li>
          <button class="popup-main-btn" type="button" data-target="sheshbesh">שש בש</button>
          <ul class="popup-sub" id="sub-sheshbesh">
            <li><a href="Backgammon Custum.html">עיצוב אישי</a></li>
            <li><a href="Backgammon Models.html">דגמים</a></li>
          </ul>
        </li>
        <li>
          <button class="popup-main-btn" type="button" data-target="matkot">מטקות</button>
          <ul class="popup-sub" id="sub-matkot">
            <li><a href="Matka Custum.html">עיצוב אישי</a></li>
            <li><a href="Matka Models.html">דגמים</a></li>
          </ul>
        </li>
        <li><a href="Canvas.html">קנבסים</a></li>
        <li><a href="Record.html">תקליטים</a></li>
      </ul>
    </div>
    <main class="record-main">
      <h2 class="matka-custom-title">עיצוב אישי | מטקה</h2>
      <div class="matka-custom-container">
        <!-- טופס משמאל -->
        <form class="record-form matka-custom-form" autocomplete="off" novalidate>
          <div class="record-color-row">
            <label class="record-label" for="matka-color1">*צבע 1:</label>
            <input id="matka-color1-text" name="matka-color1-text" type="text" class="record-color-input" placeholder="לדוג' תכלת, אפור..." style="width: 120px;" />
            <input id="matka-color1" name="matka-color1" type="color" value="#5C4638" aria-label="בחר צבע ראשון" />
          </div>
          <div class="record-color-row">
            <label class="record-label" for="matka-color2">*צבע 2:</label>
            <input id="matka-color2-text" name="matka-color2-text" type="text" class="record-color-input" placeholder="לדוג' לבן, בז'..." style="width: 120px;" />
            <input id="matka-color2" name="matka-color2" type="color" value="#5C4638" aria-label="בחר צבע שני" />
          </div>
          <label for="matka-desc1" class="record-label">*הסבר מטקה 1:</label>
          <textarea id="matka-desc1" class="record-textarea" placeholder="פרטו על הציור/העיצוב של מטקה 1..."></textarea>
          <label for="matka-desc2" class="record-label">*הסבר מטקה 2:</label>
          <textarea id="matka-desc2" class="record-textarea" placeholder="פרטו על הציור/העיצוב של מטקה 2..."></textarea>
          <div class="record-file-upload-row">
            <label class="record-label" style="margin-bottom:0;">*צרף קובץ:</label>
          </div>
          <div class="file-upload-container" id="fileUploadContainer">
            <div class="file-upload-text">גרור קבצים לכאן או לחץ לבחירה</div>
            <div class="file-upload-subtext">
              <span class="file-type-icon">PNG</span>
              <span class="file-type-icon">JPEG</span>
              <span class="file-type-icon">JPG</span>
              <span class="file-type-icon">PDF</span>
              עד 5 קבצים, תמונות יודחסו אוטומטית (מקסימום 5MB לקבצים)
            </div>
            <div class="file-count-display" id="fileCountDisplay" style="display:none;">
              נבחרו <span id="fileCount">0</span> קבצים
            </div>
            <input type="file" id="record-file" multiple accept="image/png,image/jpeg,application/pdf" style="display:none" />
          </div>
          <div class="file-preview-container" id="filePreviewContainer"></div>
          <div class="file-error-message" id="fileErrorMessage"></div>
          <div class="record-qty-row">
            <label class="record-label" for="record-qty">כמות:</label>
            <input type="number" id="record-qty" class="record-qty-input" min="1" value="1" required />
          </div>
          <div class="record-btn-row">
            <button type="submit" class="record-add-btn">הוסף לסל</button>
          </div>
        </form>
        <!-- גלריית תמונות מימין -->
        <div class="record-gallery">
          <div class="record-gallery-row">
            <div class="record-thumbs-col">
              <img class="record-thumb selected" src="img/matka1.jpg" alt="מטקה 1" data-img="img/matka1.jpg" />
              <img class="record-thumb" src="img/matka2.jpg" alt="מטקה 2" data-img="img/matka2.jpg" />
              <img class="record-thumb" src="img/matka3.jpg" alt="מטקה 3" data-img="img/matka3.jpg" />
              <img class="record-thumb" src="img/matka4.jpg" alt="מטקה 4" data-img="img/matka4.jpg" />
              <img class="record-thumb" src="img/matka5.jpg" alt="מטקה 5" data-img="img/matka5.jpg" />
            </div>
            <img id="mainRecordImg" class="record-main-img" src="img/matka1.jpg" alt="מטקה מעוצבת" />
          </div>
        </div>
      </div>
      <div class="record-note" style="text-align: right !important; padding-right: 40px !important; margin: 25px 0 0 0 !important; width: 100% !important; max-width: none !important;">המחיר משתנה בהתאם לציור שתבקשו.<br>טווח המחירים נע בין 150-300 ש"ח.</div>
    </main>
  </div>
  <footer>
    <div class="footer-content">
      <div class="footer-nav">
        <a href="homepage.html" class="footer-link">דף הבית</a>
        <span class="footer-sep">│</span>
        <a href="shop.html" class="footer-link">חנות</a>
        <span class="footer-sep">│</span>
        <a href="policy.html" class="footer-link">מדיניות</a>
        <span class="footer-sep">│</span>
        <a href="contact.html" class="footer-link">צור קשר</a>
      </div>
      <div class="footer-contact">
        <div class="footer-contact-item">
          <a href="https://www.instagram.com/paintz.official/" target="_blank" rel="noopener">
            <img src="instagram.svg" alt="Instagram" class="footer-icon" />
          </a>
          <span class="footer-contact-text">paintz.official@</span>
        </div>
        <div class="footer-contact-item">
          <a href="mailto:paintz.yf@gmail.com">
            <img src="email.svg" alt="Email" class="footer-icon" />
          </a>
          <span class="footer-contact-text">paintz.yf@gmail.com</span>
        </div>
        <div class="footer-contact-item">
          <a href="https://maps.google.com/?q=פתח+תקווה" target="_blank">
            <img src="location.svg" alt="Location" class="footer-icon" />
          </a>
          <span class="footer-contact-text">פתח תקווה</span>
        </div>
      </div>
    </div>
    <div class="footer-logo"></div>
  </footer>
  <section class="copyright-section">
    <div class="copyright-text">Paintz 2025©</div>
  </section>
    <script src="cart-sync.js"></script>
    <script src="file-upload-system.js"></script>
  <script>
    // וידוא שה-side-cart מוסתר בטעינת הדף
    document.addEventListener('DOMContentLoaded', function() {
      const sideCart = document.getElementById('sideCart');
      if (sideCart) {
        sideCart.classList.remove('active');
      }
      setSubmenuEvents();
      // אתחול מערכת הוספת קבצים
      const fileUploadSystem = new FileUploadSystem({
        container: document.getElementById('fileUploadContainer'),
        previewContainer: document.getElementById('filePreviewContainer'),
        errorContainer: document.getElementById('fileErrorMessage'),
        fileInput: document.getElementById('record-file'),
        countDisplay: document.getElementById('fileCountDisplay')
      });
      // שמירת המערכת בגלובלי לשימוש בפונקציות אחרות
      window.fileUploadSystem = fileUploadSystem;
    });
// --- Shop Popup Logic ---
  const shopBtn = document.getElementById('shopPopupBtn');
  const shopPopup = document.getElementById('shopPopup');

  function positionShopPopup() {
    const rect = shopBtn.getBoundingClientRect();
    shopPopup.style.top = rect.bottom + 'px';
    shopPopup.style.right = (window.innerWidth - rect.right) + 'px';
    shopPopup.style.left = 'auto';
    shopPopup.style.transform = 'none';
  }

  function openShopPopup() {
    positionShopPopup();
    shopPopup.style.display = 'block';
  }
  function closeShopPopup() {
    shopPopup.style.display = 'none';
    closeAllSubs();
  }

  // Desktop: open on hover, Mobile: open on click
  function setShopPopupEvents() {
    if (window.innerWidth > 700) {
      // Desktop: hover
      shopBtn.removeEventListener('click', shopBtn._shopClickHandler || (()=>{}));
      shopBtn.addEventListener('mouseenter', openShopPopup);
      shopBtn.addEventListener('mouseleave', function(e) {
        if (!shopPopup.contains(e.relatedTarget)) closeShopPopup();
      });
      shopPopup.addEventListener('mouseleave', function(e) {
        if (!shopBtn.contains(e.relatedTarget)) closeShopPopup();
      });
      shopPopup.addEventListener('mouseenter', function() { openShopPopup(); });
    } else {
      // Mobile: click
      shopBtn._shopClickHandler = function(e) {
        e.stopPropagation();
        if (shopPopup.style.display === 'block') {
          closeShopPopup();
        } else {
          openShopPopup();
        }
      };
      shopBtn.addEventListener('click', shopBtn._shopClickHandler);
      shopBtn.removeEventListener('mouseenter', openShopPopup);
      shopBtn.removeEventListener('mouseleave', closeShopPopup);
      shopPopup.removeEventListener('mouseleave', closeShopPopup);
      shopPopup.removeEventListener('mouseenter', openShopPopup);
    }
  }
  setShopPopupEvents();
  window.addEventListener('resize', setShopPopupEvents);

  window.addEventListener('resize', function() {
    if (shopPopup.style.display === 'block') {
      positionShopPopup();
    }
  });

  document.addEventListener('click', function(e) {
    if (!shopPopup.contains(e.target) && e.target !== shopBtn) {
      closeShopPopup();
    }
  });

  // Submenu logic
  function closeAllSubs() {
    document.querySelectorAll('.popup-sub').forEach(sub => sub.style.display = 'none');
  }

  function setSubmenuEvents() {
    const isDesktop = window.innerWidth > 700;
    document.querySelectorAll('.popup-main-btn').forEach(btn => {
      const target = btn.getAttribute('data-target');
      const sub = document.getElementById('sub-' + target);
      // ניקוי מאזינים ישנים
      btn.replaceWith(btn.cloneNode(true));
    });
    // צריך לבחור מחדש אחרי cloneNode
    document.querySelectorAll('.popup-main-btn').forEach(btn => {
      const target = btn.getAttribute('data-target');
      const sub = document.getElementById('sub-' + target);
      // Desktop: open submenus only on click
      btn.addEventListener('click', function(e) {
        e.stopPropagation();
        if (sub.style.display === 'block') {
          sub.style.display = 'none';
        } else {
          closeAllSubs();
          sub.style.display = 'block';
        }
      });
      // Remove hover events if exist
      btn.removeEventListener('mouseenter', null);
      btn.removeEventListener('mouseleave', null);
      if (sub) {
        sub.removeEventListener('mouseenter', null);
        sub.removeEventListener('mouseleave', null);
      }
    });
  }
  setSubmenuEvents();
  window.addEventListener('resize', setSubmenuEvents);

  // --- Side Cart Logic ---
let cart = [];

// Load cart safely using the sync API when available
function initializeCart() {
  let cart = [];
  
  // Try to load from cartSync first
  if (window.cartSync && typeof window.cartSync.loadCart === 'function') {
    cart = window.cartSync.loadCart();
  }
  
  // If cartSync failed or returned empty, try localStorage
  if (!cart || !Array.isArray(cart) || cart.length === 0) {
    try {
      const storedCart = localStorage.getItem('cart');
      if (storedCart) {
        cart = JSON.parse(storedCart);
      }
    } catch (e) {
      console.error('Failed to load cart from localStorage:', e);
      cart = [];
    }
  }
  
  // Ensure cart is an array
  if (!Array.isArray(cart)) {
    cart = [];
  }
  
  // Save the initialized cart back
  localStorage.setItem('cart', JSON.stringify(cart));
  
  // If cartSync exists, make sure it's in sync
  if (window.cartSync && typeof window.cartSync.setCart === 'function') {
    window.cartSync.setCart(cart);
  }
  
  return cart;
}

// Initialize cart immediately
initializeCart();

// Re-initialize when cart sync is available
document.addEventListener('DOMContentLoaded', function() {
  setTimeout(initializeCart, 100);
});

function addToCart(item, onlyQty) {
  let targetItemIndex = null;
  
  // טעינת הסל הנוכחי
  if (window.cartSync && typeof window.cartSync.loadCart === 'function') {
    cart = window.cartSync.loadCart();
  } else {
    try {
      cart = JSON.parse(localStorage.getItem('cart') || '[]');
    } catch (e) {
      cart = [];
    }
  }
  
  // בדיקה מלאה של מוצר קיים (כל השדות צריכים להיות זהים!)
  let existingIndex = window.cartSync && window.cartSync.areItemsIdentical 
    ? cart.findIndex(existing => window.cartSync.areItemsIdentical(existing, item))
    : cart.findIndex(existing => 
        existing.title === item.title && 
        existing.subtitle === item.subtitle &&
        existing.notes === item.notes &&
        existing.desc === item.desc &&
        existing.price === item.price &&
        JSON.stringify(existing.files || []) === JSON.stringify(item.files || [])
      );
  
  if (existingIndex !== -1) {
    // מוצר קיים - הוסף כמות
    cart[existingIndex].qty += (item.qty || 1);
    targetItemIndex = existingIndex;
  } else if (!onlyQty) {
    // מוצר חדש - הוסף לסל
    cart.push(item);
    targetItemIndex = cart.length - 1;
  }
  
  // שמירה בחזרה עם עדכון מיידי של הממשק
  try {
    if (window.cartSync && typeof window.cartSync.addItem === 'function') {
      if (existingIndex !== -1) {
        window.cartSync.updateItem(existingIndex, {qty: cart[existingIndex].qty});
      } else {
        // Check if adding this item would exceed cart size limit
        const testCart = [...cart, item];
        const testCartString = JSON.stringify(testCart);
        const testCartSize = new Blob([testCartString]).size;
        const testCartSizeMB = (testCartSize / (1024 * 1024)).toFixed(2);
        const maxCartSize = 5 * 1024 * 1024; // 5MB max (based on typical localStorage limits)
        

        
        if (testCartSize > maxCartSize) {
          throw new Error(`הסל יהיה גדול מדי (${testCartSizeMB}MB). אנא הסר פריטים מהסל או הקטן את הקבצים.`);
        }
        
        window.cartSync.addItem(item);
      }
    } else {
      localStorage.setItem('cart', JSON.stringify(cart));
    }
  } catch (storageError) {
    console.error('Storage error:', storageError);
    if (storageError.message && storageError.message.includes('הסל יהיה גדול מדי')) {
      throw storageError; // Re-throw our custom error
    } else if (storageError.name === 'QuotaExceededError') {
      throw new Error('הסל גדול מדי - לא ניתן לשמור בזיכרון הדפדפן. אנא הסר פריטים מהסל או הקטן את הקבצים.');
    } else {
      throw new Error('שגיאה בשמירת המוצר - הקבצים גדולים מדי או שאין מקום בזיכרון');
    }
  }
  
  // בדיקה שהמוצר באמת נוסף
  let verificationCart = [];
  try {
    if (window.cartSync && typeof window.cartSync.loadCart === 'function') {
      verificationCart = window.cartSync.loadCart();
    } else {
      verificationCart = JSON.parse(localStorage.getItem('cart') || '[]');
    }
  } catch (e) {
    throw new Error('שגיאה בטעינת הסל לאימות');
  }
  
  const itemExists = verificationCart.some(cartItem => 
    cartItem.title === item.title && 
    cartItem.subtitle === item.subtitle &&
    cartItem.notes === item.notes &&
    cartItem.desc === item.desc &&
    cartItem.price === item.price &&
    JSON.stringify(cartItem.files || []) === JSON.stringify(item.files || [])
  );
  
  if (!itemExists) {
    console.error('המוצר לא נוסף לסל למרות שלא הייתה שגיאה');
    throw new Error('המוצר לא נוסף לסל - ייתכן שהקבצים גדולים מדי');
  }
  
  // עדכון מיידי של הממשק
  updateCartBadge();
  renderCart();
  
  // אתחול מחדש של הצבעים אחרי הזמנה
  setTimeout(() => {
    const colorInputs = document.querySelectorAll('input[type="color"]');
    colorInputs.forEach(function(input) {
      if (!input.value || input.value === '#000000') {
        input.value = '#5C4638';
      }
      updateColorDisplay(input);
    });
  }, 100);
  
  // פתיחת הסל הקטן אוטומטית עם אנימציה למוצר הנכון
  if (targetItemIndex !== null) {
    // מציאת האינדקס הנכון של המוצר
    const finalTargetIndex = window.cartSync && window.cartSync.areItemsIdentical 
      ? cart.findIndex(existing => window.cartSync.areItemsIdentical(existing, item))
      : cart.findIndex(existing => 
          existing.title === item.title && 
          existing.subtitle === item.subtitle &&
          existing.notes === item.notes &&
          existing.desc === item.desc &&
          existing.price === item.price &&
          JSON.stringify(existing.files || []) === JSON.stringify(item.files || [])
        );
    const indexToShow = finalTargetIndex !== -1 ? finalTargetIndex : cart.length - 1;
    openSideCart(indexToShow);
  }
  
  // הפעלת סנכרון נוסף לוודא שכל הטאבים מתעדכנים
  if (window.cartSync && typeof window.cartSync.synchronize === 'function') {
    setTimeout(() => {
      window.cartSync.synchronize('add-to-cart-complete');
    }, 100);
  }
}

function removeFromCart(idx) {
  if (idx >= 0 && idx < cart.length) {
    if (window.cartSync) {
      window.cartSync.removeItem(idx);
      cart = window.cartSync.loadCart();
    } else {
      cart.splice(idx, 1);
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    setTimeout(() => {
      if (window.cartSync && typeof window.cartSync.loadCart === 'function') {
        cart = window.cartSync.loadCart();
      } else {
        cart = JSON.parse(localStorage.getItem('cart') || '[]');
      }
      updateCartBadge();
      renderCart();
      
      // אתחול מחדש של הצבעים אחרי הסרת פריט
      const colorInputs = document.querySelectorAll('input[type="color"]');
      colorInputs.forEach(function(input) {
        if (!input.value || input.value === '#000000') {
          input.value = '#5C4638';
        }
        updateColorDisplay(input);
      });
    }, 50);
  }
}

function addToCart(item, onlyQty) {
  let targetItemIndex = null;
  
  // טעינת הסל הנוכחי
  if (window.cartSync && typeof window.cartSync.loadCart === 'function') {
    cart = window.cartSync.loadCart();
  } else {
    try {
      cart = JSON.parse(localStorage.getItem('cart') || '[]');
    } catch (e) {
      cart = [];
    }
  }
  
  // בדיקה מלאה של מוצר קיים (כל השדות צריכים להיות זהים!)
  let existingIndex = window.cartSync && window.cartSync.areItemsIdentical 
    ? cart.findIndex(existing => window.cartSync.areItemsIdentical(existing, item))
    : cart.findIndex(existing => 
        existing.title === item.title && 
        existing.subtitle === item.subtitle &&
        existing.notes === item.notes &&
        existing.desc === item.desc &&
        existing.price === item.price &&
        JSON.stringify(existing.files || []) === JSON.stringify(item.files || [])
      );
  
  if (existingIndex !== -1) {
    // מוצר קיים - הוסף כמות
    cart[existingIndex].qty += (item.qty || 1);
    targetItemIndex = existingIndex;
  } else if (!onlyQty) {
    // מוצר חדש - הוסף לסל
    cart.push(item);
    targetItemIndex = cart.length - 1;
  }
  
  // שמירה בחזרה עם עדכון מיידי של הממשק
  try {
    if (window.cartSync && typeof window.cartSync.addItem === 'function') {
      if (existingIndex !== -1) {
        window.cartSync.updateItem(existingIndex, {qty: cart[existingIndex].qty});
      } else {
        // Check if adding this item would exceed cart size limit
        const testCart = [...cart, item];
        const testCartString = JSON.stringify(testCart);
        const testCartSize = new Blob([testCartString]).size;
        const testCartSizeMB = (testCartSize / (1024 * 1024)).toFixed(2);
        const maxCartSize = 5 * 1024 * 1024; // 5MB max (based on typical localStorage limits)
        

        
        if (testCartSize > maxCartSize) {
          throw new Error(`הסל יהיה גדול מדי (${testCartSizeMB}MB). אנא הסר פריטים מהסל או הקטן את הקבצים.`);
        }
        
        window.cartSync.addItem(item);
      }
    } else {
      localStorage.setItem('cart', JSON.stringify(cart));
    }
  } catch (storageError) {
    console.error('Storage error:', storageError);
    if (storageError.message && storageError.message.includes('הסל יהיה גדול מדי')) {
      throw storageError; // Re-throw our custom error
    } else if (storageError.name === 'QuotaExceededError') {
      throw new Error('הסל גדול מדי - לא ניתן לשמור בזיכרון הדפדפן. אנא הסר פריטים מהסל או הקטן את הקבצים.');
    } else {
      throw new Error('שגיאה בשמירת המוצר - הקבצים גדולים מדי או שאין מקום בזיכרון');
    }
  }
  
  // בדיקה שהמוצר באמת נוסף
  let verificationCart = [];
  try {
    if (window.cartSync && typeof window.cartSync.loadCart === 'function') {
      verificationCart = window.cartSync.loadCart();
    } else {
      verificationCart = JSON.parse(localStorage.getItem('cart') || '[]');
    }
  } catch (e) {
    throw new Error('שגיאה בטעינת הסל לאימות');
  }
  
  const itemExists = verificationCart.some(cartItem => 
    cartItem.title === item.title && 
    cartItem.subtitle === item.subtitle &&
    cartItem.notes === item.notes &&
    cartItem.desc === item.desc &&
    cartItem.price === item.price &&
    JSON.stringify(cartItem.files || []) === JSON.stringify(item.files || [])
  );
  
  if (!itemExists) {
    console.error('המוצר לא נוסף לסל למרות שלא הייתה שגיאה');
    throw new Error('המוצר לא נוסף לסל - ייתכן שהקבצים גדולים מדי');
  }
  
  // עדכון מיידי של הממשק
  updateCartBadge();
  renderCart();
  
  // פתיחת הסל הקטן אוטומטית עם אנימציה למוצר הנכון
  if (targetItemIndex !== null) {
    // מציאת האינדקס הנכון של המוצר
    const finalTargetIndex = window.cartSync && window.cartSync.areItemsIdentical 
      ? cart.findIndex(existing => window.cartSync.areItemsIdentical(existing, item))
      : cart.findIndex(existing => 
          existing.title === item.title && 
          existing.subtitle === item.subtitle &&
          existing.notes === item.notes &&
          existing.desc === item.desc &&
          existing.price === item.price &&
          JSON.stringify(existing.files || []) === JSON.stringify(item.files || [])
        );
    const indexToShow = finalTargetIndex !== -1 ? finalTargetIndex : cart.length - 1;
    openSideCart(indexToShow);
  }
  
  // הפעלת סנכרון נוסף לוודא שכל הטאבים מתעדכנים
  if (window.cartSync && typeof window.cartSync.synchronize === 'function') {
    setTimeout(() => {
      window.cartSync.synchronize('add-to-cart-complete');
    }, 100);
  }
}

function removeFromCart(idx) {
  if (idx >= 0 && idx < cart.length) {
    if (window.cartSync) {
      window.cartSync.removeItem(idx);
      cart = window.cartSync.loadCart();
    } else {
      cart.splice(idx, 1);
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    setTimeout(() => {
      if (window.cartSync && typeof window.cartSync.loadCart === 'function') {
        cart = window.cartSync.loadCart();
      } else {
        cart = JSON.parse(localStorage.getItem('cart') || '[]');
      }
      updateCartBadge();
      renderCart();
    }, 50);
  }
}

// This function is now handled by the improved version above

const cartBtn = document.querySelector('.cart');
const sideCart = document.getElementById('sideCart');
const cartOverlay = document.getElementById('cartOverlay');
const closeSideCartBtn = document.getElementById('closeSideCart');
const sideCartList = document.getElementById('sideCartList');
const viewCartBtn = document.getElementById('viewCartBtn');
const cartBadge = document.getElementById('cartBadge');

// Color mapping functions
function getColorFromName(colorName) {
  const colorMap = {
    'אדום': '#FF0000', 'כחול': '#0000FF', 'ירוק': '#008000', 'צהוב': '#FFFF00',
    'כתום': '#FFA500', 'סגול': '#800080', 'ורוד': '#FFC0CB', 'חום': '#A52A2A',
    'שחור': '#000000', 'לבן': '#FFFFFF', 'אפור': '#808080', 'תכלת': '#00CED1',
    'בז\'': '#F5F5DC', 'זהב': '#FFD700', 'כסף': '#C0C0C0', 'ברונזה': '#CD7F32'
  };
  return colorMap[colorName.trim()] || '#ccc';
}

function truncateText(text, maxLength = 10) {
if (!text) return '';
return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
}

function updateCartBadge() {
  const cartBadge = document.querySelector('.cart-badge');
  if (!cartBadge) return;

  if (window.cartSync && typeof window.cartSync.synchronize === 'function') {
    // Use centralized sync system
    window.cartSync.synchronize('update-badge');
  } else {
    // Make sure cart is initialized properly
    window.cart = initializeCart();
    const total = window.cart.reduce((sum, item) => sum + (item.qty || 1), 0);
      if (total > 0) {
        cartBadge.style.display = 'block';
        cartBadge.textContent = total;
      } else {
      cartBadge.style.display = 'none';
    }
  }
}

function renderCartNotes(item) {
  const details = [];
  
  // עיבוד מיוחד למטקה עיצוב אישי
  if (item.title === 'עיצוב אישי' && item.subtitle === 'מטקה') {
    if (item.colorData) {
      // צבע מטקה 1
      details.push(`<li><span class='side-cart-item-details-label'>צבע מטקה 1:</span><span class='side-cart-item-details-value'><span class='side-cart-item-color-box' style='background:${item.colorData.color1.color}' title='${item.colorData.color1.text}'></span></span></li>`);
      
      // צבע מטקה 2
      details.push(`<li><span class='side-cart-item-details-label'>צבע מטקה 2:</span><span class='side-cart-item-details-value'><span class='side-cart-item-color-box' style='background:${item.colorData.color2.color}' title='${item.colorData.color2.text}'></span></span></li>`);
    }
    
    // הסברים
    if (item.desc) {
      if (item.desc.desc1) {
        details.push(`<li><span class='side-cart-item-details-label'>הסבר מטקה 1:</span><span class='side-cart-item-details-value'>${truncateText(item.desc.desc1, 10)}</span></li>`);
      }
      if (item.desc.desc2) {
        details.push(`<li><span class='side-cart-item-details-label'>הסבר מטקה 2:</span><span class='side-cart-item-details-value'>${truncateText(item.desc.desc2, 10)}</span></li>`);
      }
    }
    
    // קבצים
    if (item.files && item.files.length > 0) {
      const fileName = item.files[0].name;
      details.push(`<li><span class='side-cart-item-details-label'>קובץ:</span><span class='side-cart-item-details-value'>${truncateText(fileName, 10)}</span></li>`);
    }
  }
  
  return details.join('');
}

function renderCart() {
    const sideCartList = document.querySelector('.side-cart-list');
    if (!sideCartList) return;

    // Make sure cart is initialized properly
    window.cart = initializeCart();
    
    sideCartList.innerHTML = '';
    if (!window.cart.length) {
      sideCartList.innerHTML = '<div style="text-align: center; padding: 20px; font-family: \'Amatica SC\', cursive; font-size: 20px; color: #775A47;">העגלה ריקה</div>';
      return;
    }
    const visibleCart = window.cart.filter(item => window.cartSync && window.cartSync.shouldShowInMiniCart ? window.cartSync.shouldShowInMiniCart(item) : true);
    visibleCart.forEach((item, displayIdx) => {
      const idx = window.cart.indexOf(item);
    // פיצול שם המוצר
    let mainTitle = 'עיצוב אישי';
    let subTitle = '';
    // תמיכה בפורמט החדש עם subtitle
    if (item.subtitle) {
      mainTitle = item.title || '';
      subTitle = item.subtitle;
    } else if (item.title && item.title.includes('|')) {
      const parts = item.title.split('|');
      mainTitle = parts[0].trim();
      subTitle = parts[1].trim();
    } else if (item.title) {
      subTitle = item.title;
    }

    // קבלת הפרטים מהפונקציה המרכזית
    const details = window.cartSync && window.cartSync.renderCartNotes ? 
                  window.cartSync.renderCartNotes(item) : renderCartNotes(item);
    
    const row = document.createElement('div');
    row.className = 'side-cart-item';
    row.setAttribute('data-idx', idx);
    row.style.position = 'relative';
    row.innerHTML = `
      <div style="height: 120px; display: flex; flex-direction: row; width: 100%; position: relative;">
        <div style="flex: 1; height: 100%; display: flex; align-items: center;">
          <div style="width: 100%; display: flex; flex-direction: column; gap: 8px;">
            <div style="height: 30px; display: flex; align-items: center; justify-content: center;">
              <span style="font-family: 'Amatica SC', cursive; font-size: 22px; font-weight: bold; color: #775A47; text-align: center; line-height: 1.1;">${mainTitle}</span>
            </div>
            <div style="height: 24px; display: flex; align-items: center; justify-content: center;">
              <span style="font-family: 'Amatica SC', cursive; font-size: 16px; color: #BA8663; text-align: center; font-weight: normal;">${subTitle}</span>
            </div>
          </div>
        </div>
        <div style="width: 48px; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; margin-left: 8px;">
          <button class="side-cart-item-add-btn" title="הוסף" style="background: none; border: none; font-size: 22px; color: #5EA189; cursor: pointer; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;">+</button>
          <span class="side-cart-item-qty" style="width: 32px; height: 28px; font-size: 18px; color: #BA8663; display: flex; align-items: center; justify-content: center; background: none; border-radius: 0; border: none; font-family: 'Amatica SC', cursive; font-weight: bold;">${item.qty}</span>
          <button class="side-cart-item-minus-btn" title="הפחת" style="background: none; border: none; font-size: 22px; color: #5EA189; cursor: pointer; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;">–</button>
        </div>
      </div>
      <div class="side-cart-item-details" style="padding: 0 0 8px 0;">
        <ul class="side-cart-item-details-list" style="max-width: 100%; overflow: hidden;">
          ${details}
        </ul>
      </div>
      <button class="side-cart-item-trash-btn" title="מחק" style="position: absolute; left: 8px; bottom: 8px; background: none; border: none; padding: 0; margin: 0; cursor: pointer; width: 22px; height: 22px;"><span class="side-cart-item-trash-icon"></span></button>
    `;
    
    row.querySelector('.side-cart-item-trash-btn').onclick = function(e) {
      e.stopPropagation();
      showDeleteDialog(idx);
    };
    
        // כפתור הוספה
        row.querySelector('.side-cart-item-add-btn').onclick = function(e) {
      e.stopPropagation();
      if (window.cartSync && typeof window.cartSync.updateItem === 'function') {
        window.cartSync.updateItem(idx, {qty: window.cart[idx].qty + 1});
        window.cart = window.cartSync.loadCart();
      } else {
        window.cart[idx].qty += 1;
        localStorage.setItem('cart', JSON.stringify(window.cart));
      }
        updateCartBadge();
        renderCart();
    };
    // כפתור הפחתה
    row.querySelector('.side-cart-item-minus-btn').onclick = function(e) {
      e.stopPropagation();
              if (window.cart[idx].qty > 1) {
        if (window.cartSync && typeof window.cartSync.updateItem === 'function') {
        window.cartSync.updateItem(idx, {qty: window.cart[idx].qty - 1});
        window.cart = window.cartSync.loadCart();
        } else {
        window.cart[idx].qty -= 1;
        localStorage.setItem('cart', JSON.stringify(window.cart));
        }
          updateCartBadge();
          renderCart();
      } else {
        showDeleteDialog(idx);
      }
    };
    
    sideCartList.appendChild(row);
  });
}

function openSideCart(scrollToItemIndex = false) {
  sideCart.classList.add('active');
  cartOverlay.classList.add('active');
  
  if (window.innerWidth > 768) {
    document.body.style.overflow = 'hidden';
  }
  
  // Wait for cart to render before trying to highlight
  setTimeout(() => {
    if (scrollToItemIndex !== false && window.cart && window.cart.length > 0) {
      const cartItems = sideCartList.querySelectorAll('.side-cart-item');
      if (cartItems.length > 0) {
        let targetItem;
        
        if (scrollToItemIndex === true) {
          // Default to last item
          targetItem = cartItems[cartItems.length - 1];
        } else if (typeof scrollToItemIndex === 'number') {
          // Try to find item by data-idx attribute first
          const targetElement = sideCartList.querySelector(`[data-idx="${scrollToItemIndex}"]`);
          targetItem = targetElement || cartItems[scrollToItemIndex] || cartItems[cartItems.length - 1];
        }
        
        if (targetItem) {
          // Add highlight animation
          targetItem.style.transform = 'scale(1.05)';
          targetItem.style.background = 'linear-gradient(135deg, #f0f8f0, #e8f5e8)';
          targetItem.style.border = '2px solid #5EA189';
          targetItem.style.borderRadius = '8px';
          targetItem.style.transition = 'all 0.3s ease';
          targetItem.style.boxShadow = '0 4px 12px rgba(94, 161, 137, 0.3)';
          
          // Scroll to item
          targetItem.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
          });
          
          // Remove highlight after animation
          setTimeout(() => {
            targetItem.style.transform = 'scale(1)';
            targetItem.style.background = '';
            targetItem.style.border = '';
            targetItem.style.borderRadius = '';
            targetItem.style.boxShadow = '';
          }, 2000);
        }
      }
    }
  }, 300); // Increased delay to ensure cart is rendered
}

// This function is now handled by the improved version above

cartBtn.addEventListener('click', function(e) {
  e.preventDefault();
  openSideCart();
});

cartOverlay.addEventListener('click', closeSideCart);
closeSideCartBtn.addEventListener('click', closeSideCart);

viewCartBtn.addEventListener('click', function() {
  window.location.href = 'Shopping Cart.html';
});

function removeFromCart(idx) {
  // Make sure cart is initialized properly
  window.cart = initializeCart();
  
  if (idx >= 0 && idx < window.cart.length) {
    if (window.cartSync && typeof window.cartSync.removeItem === 'function') {
      window.cartSync.removeItem(idx);
      window.cart = window.cartSync.loadCart();
    } else {
      window.cart.splice(idx, 1);
      localStorage.setItem('cart', JSON.stringify(window.cart));
    }
        updateCartBadge();
        renderCart();
  }
}

let cartDeleteIdx = null;
function showDeleteDialog(idx) {
  cartDeleteIdx = idx;
  document.getElementById('cartDeleteDialog').style.display = 'flex';
}

document.getElementById('cartDeleteYes').onclick = function() {
  if (cartDeleteIdx !== null) {
    removeFromCart(cartDeleteIdx);
    cartDeleteIdx = null;
  }
  document.getElementById('cartDeleteDialog').style.display = 'none';
};

document.getElementById('cartDeleteNo').onclick = function() {
  cartDeleteIdx = null;
  document.getElementById('cartDeleteDialog').style.display = 'none';
};

// Initialize
updateCartBadge();
renderCart();

// iPad and Safari specific fixes
function ensureViewCartButtonVisibleOniPad() {
  const viewCartBtn = document.getElementById('viewCartBtn');
  if (viewCartBtn) {
    viewCartBtn.style.display = 'block';
    viewCartBtn.style.visibility = 'visible';
    viewCartBtn.style.opacity = '1';
    viewCartBtn.style.position = 'sticky';
    viewCartBtn.style.bottom = '0';
    viewCartBtn.style.zIndex = '9999';
    viewCartBtn.style.webkitTransform = 'none';
    viewCartBtn.style.transform = 'none';
  }
}

// Call the function multiple times to ensure it works
setTimeout(ensureViewCartButtonVisibleOniPad, 100);
setTimeout(ensureViewCartButtonVisibleOniPad, 500);
setTimeout(ensureViewCartButtonVisibleOniPad, 1000);
setTimeout(ensureViewCartButtonVisibleOniPad, 2000);

// Add validateForm function for Matka Custom
async function validateForm(e) {
  e.preventDefault();
  
  // Reset error states
  document.querySelectorAll('.error').forEach(el => el.classList.remove('error'));
  
  let isValid = true;
  const errorFields = [];
  
  // Validate colors
  const color1 = document.getElementById('matka-color1-text');
  const color2 = document.getElementById('matka-color2-text');
  
  if (!color1.value.trim()) {
    color1.classList.add('error');
    errorFields.push('צבע מטקה 1');
    isValid = false;
  }
  
  if (!color2.value.trim()) {
    color2.classList.add('error');
    errorFields.push('צבע מטקה 2');
    isValid = false;
  }
  
  // Validate descriptions
  const desc1 = document.getElementById('matka-desc1');
  const desc2 = document.getElementById('matka-desc2');
  
  if (!desc1.value.trim()) {
    desc1.classList.add('error');
    errorFields.push('הסבר מטקה 1');
    isValid = false;
  }
  
  if (!desc2.value.trim()) {
    desc2.classList.add('error');
    errorFields.push('הסבר מטקה 2');
    isValid = false;
  }
  
  // Validate files
  if (!window.fileUploadSystem.hasFiles()) {
    document.getElementById('fileUploadContainer').classList.add('error');
    errorFields.push('קבצים מצורפים');
    isValid = false;
  }
  
  // Validate quantity
  const qty = document.getElementById('record-qty');
  if (!qty.value || qty.value < 1) {
    qty.classList.add('error');
    errorFields.push('כמות');
    isValid = false;
  }
  
  if (!isValid) {
    return false;
  }
  
  // המרת קבצים ל-base64 באמצעות המערכת החדשה
  const filesData = await window.fileUploadSystem.convertFilesToBase64();

  // Function to convert image URL to base64 (only if already base64)
  function imageUrlToBase64(url) {
    return new Promise((resolve, reject) => {
      if (url && url.startsWith('data:image')) {
        resolve(url);
        return;
      }
      
      // For relative paths, we can't convert to base64 in browser
      
      resolve(null);
    });
  }

  // Get main gallery image
  const mainImg = document.getElementById('mainRecordImg');
  const mainImageSrc = mainImg ? mainImg.src : 'img/matka1.jpg';

  // Convert relative path to full URL for email display
  let fullImageUrl = mainImageSrc;
  if (!mainImageSrc.startsWith('http') && !mainImageSrc.startsWith('data:')) {
    fullImageUrl = `https://yardenfad.github.io/paintz-website/${mainImageSrc}`;
  }

  // Convert image to base64 for email display
  const productImageBase64 = await imageUrlToBase64(mainImageSrc);

  // If validation passed, prepare cart item with full file data
  const cartItem = {
    title: 'עיצוב אישי',
    subtitle: 'מטקה',
    qty: parseInt(qty.value),
    id: 'matka_custom_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9), // מזהה ייחודי
    timestamp: new Date().toISOString(), // תאריך ושעת יצירה
    colorData: {
      color1: {
        text: color1.value.trim(),
        color: document.getElementById('matka-color1').value,
        timestamp: new Date().toISOString() // מתי נבחר הצבע
      },
      color2: {
        text: color2.value.trim(),
        color: document.getElementById('matka-color2').value,
        timestamp: new Date().toISOString() // מתי נבחר הצבע
      }
    },
    desc: {
      desc1: desc1.value.trim(),
      desc2: desc2.value.trim(),
      timestamp: new Date().toISOString() // מתי נכתבו ההסברים
    },
    mainImage: fullImageUrl, // שמירת התמונה עם URL מלא
    img: fullImageUrl, // URL מלא - יוצג במייל
    files: filesData,
    formData: {
      // שמירת כל הנתונים מהטופס לגיבוי
      color1Text: color1.value.trim(),
      color1Hex: document.getElementById('matka-color1').value,
      color2Text: color2.value.trim(), 
      color2Hex: document.getElementById('matka-color2').value,
      description1: desc1.value.trim(),
      description2: desc2.value.trim(),
      quantity: parseInt(qty.value),
      mainImageSrc: mainImageSrc,
      filesCount: storedFiles.length,
      totalFilesSize: storedFiles.reduce((total, file) => total + file.size, 0)
    }
  };
  
  // הדפסת כל הנתונים לקונסול לוודא שהכל נשמר
  
  
  // Add to cart using the centralized cart system
  let targetIndex = -1;
  
  // Initialize cart properly
  window.cart = window.cart || (window.cartSync ? window.cartSync.loadCart() : JSON.parse(localStorage.getItem('cart') || '[]'));
  
  // Add item to cart using centralized system
  try {
    if (window.cartSync && typeof window.cartSync.addItem === 'function') {
      targetIndex = window.cartSync.addItem(cartItem);

    } else {
      // Fallback for when cartSync is not available
      let currentCart = [];
      try {
        currentCart = JSON.parse(localStorage.getItem('cart') || '[]');
      } catch (e) {
        currentCart = [];
      }
      
      // Add item to cart
      currentCart.push(cartItem);
      targetIndex = currentCart.length - 1;
      
      // Save to localStorage
      try {
        localStorage.setItem('cart', JSON.stringify(currentCart));

      } catch (storageError) {
        console.error('Storage error:', storageError);
        if (storageError.name === 'QuotaExceededError') {
          throw new Error('הקבצים גדולים מדי - לא ניתן לשמור בזיכרון הדפדפן');
        } else {
          throw new Error('שגיאה בהוספת המוצר לסל. אנא נסה שוב.');
        }
      }
    }
    
    // Verify item was actually added
    let verificationCart = [];
    try {
      if (window.cartSync && typeof window.cartSync.loadCart === 'function') {
        verificationCart = window.cartSync.loadCart();
      } else {
        verificationCart = JSON.parse(localStorage.getItem('cart') || '[]');
      }
    } catch (e) {
      throw new Error('שגיאה בטעינת הסל לאימות');
    }
    
    const itemExists = verificationCart.some(item => 
      item.title === cartItem.title && 
      item.subtitle === cartItem.subtitle &&
      item.id === cartItem.id
    );
    
    if (!itemExists) {
      console.error('המוצר לא נוסף לסל למרות שלא הייתה שגיאה');
      throw new Error('המוצר לא נוסף לסל - ייתכן שהקבצים גדולים מדי');
    }
    
    // Wait for cart-sync to finish, then update UI
    setTimeout(() => {
      // Update UI using cart-sync functions
      if (window.cartSync && typeof window.cartSync.synchronize === 'function') {
        window.cartSync.synchronize('add-item-complete');
      }
      
      // Open mini cart with animation
      const finalTargetIndex = targetIndex !== -1 ? targetIndex : 0;
      if (typeof openSideCart === 'function') {
        openSideCart(finalTargetIndex);
      }
    }, 200);
    
    // Show success message
    const toast = document.getElementById('toast');
    if (toast) {
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }
  } catch (error) {
    console.error('Error adding item to cart:', error);
    // Show error message
    const errorToast = document.getElementById('cartError');
    if (errorToast) {
      errorToast.textContent = error.message || 'שגיאה בהוספת המוצר לסל';
      errorToast.classList.add('show');
      setTimeout(() => {
        errorToast.classList.remove('show');
      }, 3000);
    }
    return false;
  }
  
  // Final synchronization
  setTimeout(() => {
    // Trigger manual synchronization
    if (window.cartSync && typeof window.cartSync.synchronize === 'function') {
      window.cartSync.synchronize('final-sync');
    }
  }, 200);
  
  // Reset form
  const currentForm = document.querySelector('.record-form');
  if (currentForm) {
    currentForm.reset();
  }
  window.fileUploadSystem.clearFiles();
  
  // Reset color displays
  document.querySelectorAll('.color-display').forEach(display => {
    display.style.backgroundColor = '#ccc';
  });
  
  // Double-check cart persistence after short delay
  setTimeout(() => {
    const finalCart = JSON.parse(localStorage.getItem('cart') || '[]');
    if (finalCart.length > 0) {
  
    }
  }, 200);
  
  return false;
}

// Remove duplicate event listeners
// Event listener cleanup is no longer needed

// Add event listeners for form validation
document.addEventListener('DOMContentLoaded', function() {
  const form = document.querySelector('.record-form');
  const addToCartBtn = document.querySelector('.record-add-btn');
  
  // Add form submission handler
  if (form) {
    form.addEventListener('submit', async function(event) {
      event.preventDefault();
      await validateForm(event);
    });
  }

  // Add button click handler
  if (addToCartBtn) {
    // Add touch events for mobile
    addToCartBtn.addEventListener('touchstart', async function(e) {
      e.preventDefault(); // Prevent double-firing on mobile
      await validateForm(e);
    });
    
    // Ensure the click event works on both mobile and desktop
    addToCartBtn.addEventListener('click', async function(e) {
      e.preventDefault();
      await validateForm(e);
    });
  }

  // Remove error on color text inputs
  document.getElementById('matka-color1-text').addEventListener('input', function() {
    if (this.value.trim()) {
      this.classList.remove('error');
    }
  });

  document.getElementById('matka-color2-text').addEventListener('input', function() {
    if (this.value.trim()) {
      this.classList.remove('error');
    }
  });

  // Remove error on description inputs
  document.getElementById('matka-desc1').addEventListener('input', function() {
    if (this.value.trim()) {
      this.classList.remove('error');
    }
  });

  document.getElementById('matka-desc2').addEventListener('input', function() {
    if (this.value.trim()) {
      this.classList.remove('error');
    }
  });



  // Remove error on quantity change
  document.getElementById('record-qty').addEventListener('input', function() {
    if (this.value && this.value >= 1) {
      this.classList.remove('error');
    }
  });
});



// Image gallery navigation functionality
document.addEventListener('DOMContentLoaded', function() {
  const mainImg = document.getElementById('mainRecordImg');
  const thumbnails = document.querySelectorAll('.record-thumb');
  
  // Add click event listeners to all thumbnails
  thumbnails.forEach(function(thumbnail, index) {
    thumbnail.addEventListener('click', function() {
      // Get the image source from data-img attribute
      const newImageSrc = this.getAttribute('data-img');
      
      // Update main image
      if (mainImg && newImageSrc) {
        mainImg.src = newImageSrc;
        mainImg.alt = this.alt;
      }
      
      // Remove selected class from all thumbnails
      thumbnails.forEach(thumb => thumb.classList.remove('selected'));
      
      // Add selected class to clicked thumbnail
      this.classList.add('selected');
    });
    
    // Set the first thumbnail as selected by default
    if (index === 0) {
      thumbnail.classList.add('selected');
    }
  });
});

// Event listeners are now handled in the validateForm function

// Function is no longer needed as notes are handled in validateForm

// Color picker functionality for mobile
document.addEventListener('DOMContentLoaded', function() {
  // Get all color inputs
  const colorInputs = document.querySelectorAll('input[type="color"]');
  
  // Initialize colors on page load
  function initializeColors() {
    colorInputs.forEach(function(input) {
      // Set the default color if not already set
      if (!input.value || input.value === '#000000') {
        input.value = '#5C4638';
      }
      updateColorDisplay(input);
    });
  }
  
  // Add event listeners to each color input
  colorInputs.forEach(function(input) {
    // Set initial color display
    updateColorDisplay(input);
    
    // Add change event listener
    input.addEventListener('change', function() {
      updateColorDisplay(this);
    });
    
    // Add input event listener for real-time updates
    input.addEventListener('input', function() {
      updateColorDisplay(this);
    });
  });
  
  function updateColorDisplay(colorInput) {
    const color = colorInput.value;
    
    // Update the input's background color directly
    colorInput.style.backgroundColor = color;
    
    // Remove any unwanted elements that might have been created
    const unwantedElements = colorInput.querySelectorAll('*');
    unwantedElements.forEach(element => {
      if (element.style && element.style.backgroundColor) {
        element.remove();
      }
    });
  }
  
  // Initialize colors immediately and after a short delay
  initializeColors();
  setTimeout(initializeColors, 100);
  setTimeout(initializeColors, 500);
});

  </script>
</body>
</html>