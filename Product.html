<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light only">
  <title>Product - Paintz</title>
  <link href="https://fonts.googleapis.com/css2?family=Amatica+SC:wght@700&family=Amatic+SC:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@700&display=swap" rel="stylesheet">
  <!-- <link href="./css/main.css" rel="stylesheet"> -->
  <style>
    /* גלילה תקינה */
    html {
      overflow-x: hidden !important;
      overflow-y: auto !important;
      height: 100% !important;
      width: 100% !important;
      max-width: 100vw !important;
    }
    
    body {
      background: #F9F1DC;
      overflow-x: hidden !important;
      overflow-y: auto !important;
      height: 100% !important;
      width: 100% !important;
      max-width: 100vw !important;
      margin: 0;
      padding: 0;
    }
    
    *, *::before, *::after {
      box-sizing: border-box;
    }
    .body-center {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
    }
    /* Header */
    header {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      padding: 8px 10px;
      position: relative;
      width: 100%;
      max-width: 100vw;
      height: 90px;
      background: transparent;
      isolation: isolate;
      box-sizing: border-box;
    }
    .logo {
      width: 180px;
      height: 80px;
      background: url('logo.jpg') no-repeat center/cover;
      transform: rotate(0.67deg);
      z-index: 0;
    }
    .cart {
      position: absolute;
      width: 32px;
      height: 32px;
      right: 10px;
      top: 10px;
      z-index: 1;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .cart-icon {
      width: 32px;
      height: 32px;
      background: url('shop.svg') no-repeat center center;
      background-size: contain;
      background-color: transparent;
      position: relative;
    }
    .cart-badge {
      position: absolute;
      left: 50%;
      bottom: 3px;
      top: auto;
      transform: translateX(-50%);
      color: #111;
      font-size: 18px;
      font-family: 'Rubik', sans-serif;
      font-weight: bold;
      background: none;
      border: none;
      width: auto;
      height: auto;
      line-height: 1;
      display: block;
      z-index: 2;
      pointer-events: none;
    }

    /* Side Cart Styles */
    .cart-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.25);
      z-index: 99;
      transition: opacity 0.3s;
    }
    .cart-overlay.active {
      display: block;
      opacity: 1;
    }
    .side-cart {
      position: fixed;
      top: 0;
      right: -100%;
      width: 370px;
      max-width: 90vw;
      height: 100vh;
      background: #fff;
      box-shadow: -2px 0 16px #0002;
      z-index: 100;
      transform: translateX(100%);
      transition: all 0.35s cubic-bezier(.7,.2,.2,1);
      display: flex;
      flex-direction: column;
      padding: 0;
      visibility: hidden;
      opacity: 0;
      pointer-events: none;
    }
    .side-cart.active {
      right: 0;
      transform: translateX(0);
      visibility: visible;
      opacity: 1;
      pointer-events: auto;
    }
    .side-cart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 18px 20px 10px 20px;
      border-bottom: 1px solid #eee;
      background: #BA8663;
    }
    .side-cart-title {
      font-family: 'Amatica SC', cursive;
      font-size: 32px;
      font-weight: 700;
      color: #fff;
    }
    .side-cart-close {
      background: none;
      border: none;
      font-size: 32px;
      color: #775A47;
      cursor: pointer;
      font-family: inherit;
      line-height: 1;
    }
    .side-cart-list {
      flex: 1;
      overflow-y: auto;
      padding: 10px 0 0 0;
      background: #fff;
    }
    .side-cart-item {
      display: flex;
      align-items: flex-start;
      justify-content: flex-start;
      background: #F9F1DC;
      border-radius: 8px;
      margin: 0 16px 12px 16px;
      padding: 10px 10px 10px 6px;
      box-shadow: 0 1px 4px #0001;
      position: relative;
      min-height: 60px;
      user-select: none;
      overflow: hidden;
    }
    .side-cart-item-header {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 12px;
      width: 100%;
      height: 70px;
      min-height: 70px;
    }
    .side-cart-item-title-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      flex: 1;
      margin: 0;
      padding: 0;
      min-width: 0;
    }
    .side-cart-item-title-main, .side-cart-item-title-sub {
      font-size: 20px;
      font-weight: 800;
      color: #775A47;
      font-family: 'Amatica SC', cursive;
      line-height: 1.08;
      text-align: center;
      margin: 0;
      padding: 0;
      max-width: 90px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .side-cart-item-title-sub {
      font-weight: 800;
      margin-top: 0;
      margin-bottom: 0;
    }
    .side-cart-item-qty {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 400;
      color: #BA8663;
      width: 32px;
      height: 22px;
      background: #f6eee0;
      border-radius: 8px;
      text-align: center;
      margin: 0;
      font-family: 'Amatica SC', cursive;
    }
    .side-cart-item-details {
      margin: 6px 0 0 0;
      padding: 0;
      width: 100%;
    }
    .side-cart-item-details-list {
      list-style: none;
      margin: 0;
      padding: 0;
      text-align: right;
      max-width: 100%;
      overflow: hidden;
    }
    .side-cart-item-details-list li {
      font-size: 15px;
      color: #5C4638;
      background: none;
      border-radius: 0;
      margin-bottom: 0;
      padding: 0;
      font-family: 'Amatica SC', cursive;
      font-weight: 700;
      direction: rtl;
      line-height: 1.5;
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .side-cart-item-details-label {
      color: #5EA189;
      font-weight: bold;
      flex-shrink: 0;
      text-align: right;
    }
    .side-cart-item-details-value {
      flex: 1;
      min-width: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .side-cart-item-color-box {
      display: inline-block;
      width: 11px;
      height: 11px;
      border-radius: 2px;
      border: 1px solid #ccc;
      margin-left: 4px;
      vertical-align: middle;
      align-self: center;
    }
    .side-cart-item-actions {
      position: absolute;
      left: 8px;
      bottom: 6px;
      display: flex;
      flex-direction: row;
      gap: 6px;
      z-index: 2;
    }
    .side-cart-item-trash-btn, .side-cart-item-add-btn {
      background: none;
      border: none;
      padding: 0;
      margin: 0;
      cursor: pointer;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.7;
      transition: opacity 0.2s;
    }
    .side-cart-item-trash-btn:hover, .side-cart-item-add-btn:hover {
      opacity: 1;
    }
    .side-cart-item-trash-icon {
      width: 20px;
      height: 20px;
      background: url('trash.svg') no-repeat center/contain;
      display: inline-block;
    }
    .side-cart-item-plus-icon {
      font-size: 20px;
      font-weight: bold;
      color: #5EA189;
      display: inline-block;
      line-height: 1;
    }
    /* דיאלוג מחיקה */
    .cart-delete-dialog {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.18);
      z-index: 200;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .cart-delete-dialog-content {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 16px #0003;
      padding: 32px 28px 18px 28px;
      min-width: 260px;
      text-align: center;
    }
    .cart-delete-dialog-title {
      font-family: 'Amatica SC', cursive;
      font-size: 22px;
      color: #775A47;
      margin-bottom: 18px;
    }
    .cart-delete-dialog-actions {
      display: flex;
      justify-content: center;
      gap: 18px;
    }
    .cart-delete-btn-yes {
      background: #e74c3c;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      font-family: 'Amatica SC', cursive;
      padding: 6px 22px;
      cursor: pointer;
    }
    .cart-delete-btn-no {
      background: #eee;
      color: #775A47;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      font-family: 'Amatica SC', cursive;
      padding: 6px 22px;
      cursor: pointer;
    }
    @media (max-width: 700px) {
      .side-cart {
        width: 98vw;
        max-width: 98vw;
      }
      
      /* Ensure the view cart button is always visible on mobile */
      .side-cart-view-btn {
        position: sticky;
        bottom: 0;
        width: calc(100% - 32px);
        margin: 16px 16px 18px 16px;
        height: 48px;
        background: #5EA189;
        color: #fff;
        font-family: 'Amatica SC', cursive;
        font-size: 20px;
        font-weight: 700;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.2s;
        display: block;
        z-index: 10;
        box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
      }
      
      .side-cart-view-btn:hover {
        background: #4b8c74;
      }
      
      /* Adjust side-cart-list padding to prevent overlap */
      .side-cart-list {
        padding: 10px 0 80px 0;
      }
      
      /* Tablet styles for medium screens */
      @media (min-width: 701px) and (max-width: 1024px) {
        .side-cart-view-btn {
          position: sticky;
          bottom: 0;
          width: calc(100% - 32px);
          margin: 16px 16px 25px 16px;
          height: 48px;
          background: #5EA189;
          color: #fff;
          font-family: 'Amatica SC', cursive;
          font-size: 20px;
          font-weight: 700;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          transition: background 0.2s;
          display: block !important;
          z-index: 10;
          box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
        }
        
        .side-cart-view-btn:hover {
          background: #4b8c74;
        }
        
        /* Adjust side-cart-list padding to prevent overlap */
        .side-cart-list {
          padding: 10px 0 100px 0;
        }
      }
      
      /* iPad and Safari specific fixes */
      @media only screen and (min-device-width: 768px) and (max-device-width: 1024px) and (-webkit-min-device-pixel-ratio: 1) {
        .side-cart-view-btn {
          position: sticky !important;
          bottom: 0 !important;
          z-index: 9999 !important;
          -webkit-transform: none !important;
          transform: none !important;
          display: block !important;
          visibility: visible !important;
          opacity: 1 !important;
        }
        
        .side-cart-list {
          padding: 10px 0 120px 0;
        }
      }
      
      /* Safari specific fixes */
      @media screen and (-webkit-min-device-pixel-ratio: 0) {
        .side-cart-view-btn {
          position: sticky !important;
          bottom: 0 !important;
          z-index: 9999 !important;
          -webkit-transform: none !important;
          transform: none !important;
          display: block !important;
          visibility: visible !important;
          opacity: 1 !important;
        }
      }
      
      /* iOS Safari specific fixes */
      @supports (-webkit-touch-callout: none) {
        .side-cart-view-btn {
          position: sticky !important;
          bottom: 0 !important;
          z-index: 9999 !important;
          -webkit-transform: none !important;
          transform: none !important;
          display: block !important;
          visibility: visible !important;
          opacity: 1 !important;
        }
      }
      
    }
    .side-cart-view-btn {
      width: 90%;
      margin: 16px auto 18px auto;
      height: 48px;
      background: #5EA189;
      color: #fff;
      font-family: 'Amatica SC', cursive;
      font-size: 24px;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
      display: block;
    }
    .side-cart-view-btn:hover {
      background: #4b8c74;
    }
    /* Navigation Bar */
    nav {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: center;
      padding: 0 5vw;
      gap: 30px;
      width: 100%;
      max-width: 100vw;
      height: 44px;
      background: #BA8663;
      margin-bottom: 20px;
      box-sizing: border-box;
        }
    .nav-link {
      width: auto;
      min-width: 65px;
      height: 48px;
      font-family: 'Amatica SC', cursive;
      font-weight: 700;
      font-size: 32px;
      line-height: 48px;
      display: flex;
      align-items: center;
      text-align: center;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: #fff;
      margin: 0 2vw;
      transform: rotate(0.52deg);
      background: transparent;
      cursor: pointer;
      text-decoration: none;
      justify-content: center;    }
    /* --- Shop Popup refined styles --- */
    .shop-popup {
      display: none;
      position: fixed;
      top: 100%;
      right: 0;
      left: auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 12px #0002;
      z-index: 1000;
      min-width: 140px;
      padding: 4px 0;
      font-family: 'Amatica SC', cursive;
      font-size: 18px;
      color: #5C4638;
      direction: rtl;
    }
    .shop-popup ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    .shop-popup > ul > li {
      padding: 0 10px;
      margin-bottom: 1px;
      position: relative;
    }
    .shop-popup a, .shop-popup .popup-main-btn {
      color: #5C4638;
      text-decoration: none;
      background: none;
      border: none;
      font: inherit;
      cursor: pointer;
      padding: 2px 0;
      width: 100%;
      text-align: right;
      display: block;
      border-radius: 6px;
      transition: background 0.2s;
      line-height: 1.2;
      font-size: 18px;
    }
    .shop-popup a:hover, .shop-popup .popup-main-btn:hover {
      background: #f9f1dc;
    }
    .popup-sub {
      display: none;
      position: absolute;
      right: 100%;
      top: 0;
      background: #f6eee0;
      border-radius: 8px;
      box-shadow: 0 2px 8px #0001;
      padding: 2px 0;
      min-width: 110px;
      z-index: 101;
    }
    .popup-sub li {
      margin-bottom: 0;
      padding: 0 6px;
    }
    .popup-sub a {
      font-size: 15px;
      line-height: 1.2;
      padding: 2px 0;
    }
    .shop-popup .active + .popup-sub {
      display: block;
    }
    .shop-popup-btn {
      border: none !important;
      outline: none !important;
      box-shadow: none !important;
      background: transparent;
    }
    /* --- פופאפ חנות בפוטר --- */
    .footer-link-shop-popup {
      position: relative;
    }
    .footer-shop-popup {
      display: none;
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 12px #0002;
      z-index: 200;
      min-width: 140px;
      padding: 4px 0;
      font-family: 'Amatica SC', cursive;
      font-size: 18px;
      color: #5C4638;
      direction: rtl;
    }
    /* Footer Section */
    footer {
      display: flex;
      flex-direction: row-reverse;
      justify-content: space-between;
      align-items: flex-start;
      background: #5C4638;
      padding: 10px 16px;
      box-sizing: border-box;
      height: 120px;
      direction: rtl;
      position: relative;
    }
    .footer-content {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 100%;
    }
    .footer-nav {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-right: auto;
      margin-left: auto;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      right: auto;
      top: 10px;
    }
    .footer-link {
      font-family: 'Amatica SC', cursive;
      font-weight: 700;
      font-size: 20px;
      color: white;
      text-decoration: none;
    }
    .footer-sep {
      font-size: 20px;
      color: white;
    }
    .footer-contact {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
      position: absolute;
      bottom: 10px;
      left: 16px;
    }
    .footer-contact-item {
      display: flex;
      flex-direction: row-reverse;
      align-items: center;
      gap: 10px;
    }
    .footer-icon {
      width: 18px;
      height: 18px;
    }
    .footer-contact-text {
      font-family: 'Amatica SC', cursive;
      font-weight: 700;
      font-size: 16px;
      color: white;
    }
    .footer-logo {
      width: 90px;
      height: 90px;
      background: url('logo.jpg') no-repeat center/contain;
      border-radius: 12px;
    }
    .copyright-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0;
      gap: 2px;
      width: 100%;
      max-width: 100vw;
      height: 20px;
      background: transparent;
      margin-top: 2px;
      box-sizing: border-box;
    }
    .copyright-text {
      width: 180px;
      height: 20px;
      font-family: 'Amatica SC', cursive;
      font-weight: 700;
      font-size: 16px;
      color: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }
    .record-title {
      font-family: 'Amatica SC', cursive;
      font-size: 54px;
      color: #775A47;
      text-align: center;
      margin-bottom: 10px;
      margin-top: 2px;
      width: 100%;
    }
    
    /* Product Page Styles */
    .product-container {
      display: flex;
      flex-direction: row-reverse;
      gap: 40px;  /* הגדלת הרווח בין התמונה לריבוע ההזמנה */
      width: 100%;
      max-width: 1200px;
      justify-content: center;
      align-items: flex-start;
      margin-bottom: 0px;
      padding: 0 10px;
    }
    
    .product-gallery {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      min-width: 350px;
      width: 350px;
      min-height: 500px;
      height: 100%;
      position: relative;
      gap: 18px;
      padding: 20px 0;  /* רווח מעל ומתחת לגלריה */
    }
    
    .main-image {
      width: 320px;
      height: 320px;
      aspect-ratio: 1/1;
      object-fit: cover;
      border-radius: 16px;
      border: 3px solid #222;
      background: #2222;
      margin: 20px 0;  /* רווח מעל ומתחת לתמונה הגדולה */
      overflow: hidden;
      order: 2;
      flex-shrink: 0;
      min-width: 320px;
      min-height: 320px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .main-image img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    
    .thumbnail-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
      justify-content: center;
      order: 1;
    }
    
    .thumbnail {
      width: 48px;
      height: 48px;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid #222;
      cursor: pointer;
      background: #2222;
      transition: border 0.2s;
      flex-shrink: 0;
    }

    .thumbnail.selected {
      border: 2px solid #BA8663;
    }

    .thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 6px;
    }
    
    .product-details {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
      min-width: 400px;
      background: #e2c9a6;
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 2px 12px #0001;
      position: relative;
    }
    
    .product-title {
      font-family: 'Amatica SC', cursive;
      font-size: 36px;
      color: #5C4638;
      margin: 0 0 16px;
    }
    
    .price-amount {
      font-family: 'Amatica SC', cursive;
      font-size: 32px;
      color: #5C4638;
      font-weight: bold;
      text-align: left;
      margin-bottom: 16px;
      margin-right: auto;  /* מזיז את המחיר לצד שמאל */
    }
    
    .price-container {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: auto;
    }
    
    .price-note {
      font-size: 16px;
      color: #000;
      opacity: 0.7;
      margin-top: 4px;
      font-family: 'Amatica SC', cursive;
    }
    
    .quantity-section {
      width: 100%;
      margin-bottom: 16px;
    }
    
    .quantity-label {
      font-family: 'Amatica SC', cursive;
      font-size: 32px;
      color: #5C4638;
      margin-bottom: 8px;
      display: block;
    }
    
    .quantity-input {
      width: 80px;
      font-size: 22px;
      border: 2px solid #BA8663;
      border-radius: 6px;
      padding: 6px 8px;
      font-family: 'Amatica SC', cursive;
      background: #f9f1dc;
      text-align: center;
    }
    
    .quantity-input::-webkit-inner-spin-button,
    .quantity-input::-webkit-outer-spin-button {
      opacity: 1;
      margin-left: 8px;
    }
    
    .notes-section {
      width: 100%;
      margin-bottom: 8px;
    }
    
    .notes-label {
      font-family: 'Amatica SC', cursive;
      font-size: 32px;
      color: #5C4638;
      margin-bottom: 8px;
      display: block;
    }
    
    .notes-textarea {
      width: 100%;
      min-width: 100%;
      max-width: 100%;
      height: 120px;
      border-radius: 8px;
      border: 2px solid #BA8663;
      font-size: 22px;
      padding: 10px;
      font-family: 'Amatica SC', cursive;
      resize: vertical;
      background: #f9f1dc;
      box-sizing: border-box;
    }
    
    .add-to-cart-btn {
      width: 220px;
      height: 60px;
      background: #7bb39b;
      color: #fff;
      font-family: 'Amatica SC', cursive;
      font-size: 36px;
      border: 3px solid #fff;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
      margin: 0 auto;
      display: block;
    }
    
    .add-to-cart-btn:hover {
      background: #5C4638;
    }
    
    .record-note {
      font-size: 16px;
      color: #000;
      opacity: 0.7;
      text-align: right;
      font-family: 'Amatica SC', cursive;
      margin: 10px 0;
      line-height: 1.5;
      position: static;
      width: 100%;
      padding-right: 10px;
    }

    @media (max-width: 700px) {
        /* Mobile Product Page */
        main {
        padding: 0 !important;
        margin: 0;
      }
      /* Mobile Header */
      header {
        height: 70px;
        padding: 6px 8px;
      }
      
      .logo {
        width: 140px;
        height: 60px;
      }
      
      .cart {
        width: 28px;
        height: 28px;
        right: 8px;
        top: 8px;
      }
      
      .cart-icon {
        width: 28px;
        height: 28px;
      }
      
      .cart-badge {
        font-size: 14px;
        bottom: 2px;
      }
      
      /* Mobile Navigation */
      nav {
        height: 40px;
        padding: 0 2vw;
        gap: 15px;
        overflow-x: auto;
        overflow-y: hidden;
        white-space: nowrap;
        margin: 0 0 30px 0;  /* רווח מתחת לנאב, שזה מעל הכותרת */
      }
      
      .nav-link {
        font-size: 24px;
        line-height: 40px;
        height: 40px;
        min-width: 50px;
        margin: 0 1vw;
        white-space: nowrap;
        flex-shrink: 0;
      }
      
      .side-cart {
        width: 98vw;
        max-width: 98vw;
      }
      
      /* Ensure the view cart button is always visible on mobile */
      .side-cart-view-btn {
        position: sticky;
        bottom: 0;
        width: calc(100% - 32px);
        margin: 16px 16px 18px 16px;
        height: 48px;
        background: #5EA189;
        color: #fff;
        font-family: 'Amatica SC', cursive;
        font-size: 20px;
        font-weight: 700;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.2s;
        display: block;
        z-index: 10;
        box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
      }
      
      .side-cart-view-btn:hover {
        background: #4b8c74;
      }
      
      /* Adjust side-cart-list padding to prevent overlap */
      .side-cart-list {
        padding: 10px 0 80px 0;
      }
      
      /* Mobile Shop Popup */
      .shop-popup {
        top: 100%;
        right: 0;
        left: auto;
        min-width: 140px;
        font-size: 18px;
      }
      
      .shop-popup > ul > li {
        padding: 0 8px;
        margin-bottom: 0;
      }
      
      .shop-popup a, .shop-popup .popup-main-btn {
        font-size: 18px;
        padding: 2px 0;
        line-height: 1.2;
      }
      
      .popup-sub {
        right: 100%;
        min-width: 100px;
        font-size: 16px;
      }
      
      .popup-sub a {
        font-size: 16px;
        padding: 2px 0;
      }

      /* Mobile Footer */
      footer {
        height: auto;
        min-height: 120px;
        flex-direction: column;
        align-items: center;
        text-align: center;
        padding: 15px 10px;
      }
      
      .footer-nav {
        position: static;
        transform: none;
        left: auto;
        top: auto;
        margin: 10px 0;
        flex-wrap: wrap;
        gap: 15px;
      }
      
      .footer-link {
        font-size: 18px;
      }
      
      .footer-contact {
        position: static;
        align-items: center;
        margin: 10px 0;
      }
      
      .footer-contact-text {
        font-size: 14px;
      }
      
      .footer-logo {
        width: 70px;
        height: 70px;
        margin: 10px 0;
      }
      
      /* Additional mobile styles for very small screens */
      @media (max-width: 480px) {
        .side-cart-view-btn {
          font-size: 18px;
          height: 44px;
          margin: 12px 12px 16px 12px;
          width: calc(100% - 24px);
        }
      }
    }

    @media(max-width: 900px){
      .record-title {
        font-size: 58px;
        margin: 0 0 35px 0;  /* הגדלת הרווח מתחת לכותרת */
        padding: 0;
        line-height: 1;
        font-weight: bold;
      }
      
      .product-container {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin: 0;
        padding: 0;
        width: 100%;
        box-sizing: border-box;
      }

      .product-gallery {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin: 0;
        padding: 0;
        width: 100%;
        min-height: auto;
        align-items: center;
      }

      .thumbnail-container {
        order: 1;
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        flex-wrap: nowrap;
        width: 100%;
        margin: 6px 0;
        gap: 10px;
        padding: 0;
        overflow-x: auto;
      }
      
      .thumbnail {
        width: 35px !important;
        height: 35px !important;
        flex-shrink: 0;
      }

      .main-image {
        order: 2;
        width: 300px !important;
        height: 300px !important;
        min-width: 300px !important;
        min-height: 300px !important;
        max-width: 300px !important;
        max-height: 300px !important;
        margin: 4px auto 35px auto;  /* הגדלת הרווח מתחת לתמונה הגדולה */
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .product-details {
        order: 3;
        padding: 15px;
        width: 100vw;
        margin: 0;
        background: #e2c9a6;
        border-radius: 16px;  /* מתקן את הקצוות המעוגלים */
        position: relative;
        left: 50%;
        transform: translateX(-50%);
      }

      .record-note {
        order: 4;
        font-size: 13px;
        margin: 2px auto;
        padding: 0 8px;
        text-align: center;
        line-height: 1.2;
        max-width: 320px;
      }
      
      .notes-label, .quantity-label {
        font-size: 20px;
        margin-bottom: 2px;
      }
      
      .notes-textarea {
        font-size: 16px;
        padding: 8px;
        min-height: 70px;
      }
      
      .quantity-input {
        font-size: 18px;
        padding: 4px 8px;
        width: 80px;
      }
      
      .price-container {
        flex-direction: column;
        gap: 8px;
        align-items: center;
        margin-top: 6px;
      }
      
      .price-amount {
        font-size: 32px;
        margin: 0;
        margin-right: auto;  /* מזיז את המחיר לצד שמאל גם במובייל */
        margin-left: 0;
      }
      
      .add-to-cart-btn {
        font-size: 20px;
        padding: 8px 20px;
        width: 100%;
        max-width: 250px;
        margin: 0;
      }
      
      .record-note {
        font-size: 13px;
        margin: 2px auto;
        padding: 0 8px;
        text-align: center;
        line-height: 1.2;
        max-width: 320px;
      }      
    }

    .required {
      color: red;
      margin-right: 4px;
    }

    .error-message {
      color: red;
      font-family: 'Amatica SC', cursive;
      font-size: 18px;
      margin-top: 4px;
      display: none;
    }

    .notes-textarea.error {
      border-color: red;
    }

    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background-color: #7bb39b;
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      font-family: 'Amatica SC', cursive;
      font-size: 24px;
      opacity: 0;
      transition: all 0.3s ease-in-out;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
  </style>
</head>
<body>
  <div id="cartOverlay" class="cart-overlay"></div>
  <div id="cartDeleteDialog" class="cart-delete-dialog" style="display:none;">
    <div class="cart-delete-dialog-content">
      <div class="cart-delete-dialog-title">האם למחוק את המוצר מהעגלה?</div>
      <div class="cart-delete-dialog-actions">
        <button id="cartDeleteYes" class="cart-delete-btn-yes">כן</button>
        <button id="cartDeleteNo" class="cart-delete-btn-no">לא</button>
      </div>
    </div>
  </div>
  <aside id="sideCart" class="side-cart">
    <div class="side-cart-header">
      <span class="side-cart-title">סל קניות</span>
      <button class="side-cart-close" id="closeSideCart">×</button>
    </div>
    <div class="side-cart-list" id="sideCartList">
      <!-- כאן יתווספו המוצרים -->
    </div>
    <button class="side-cart-view-btn" id="viewCartBtn">לצפייה בסל הקניות</button>
  </aside>
  <div class="body-center">
    <header>
      <div class="logo"></div>
      <div class="cart">
        <div class="cart-icon">
          <span class="cart-badge" id="cartBadge" style="display:none;">0</span>
        </div>
      </div>
    </header>
    <nav>
      <a class="nav-link" href="homepage.html">דף הבית</a>
      <button class="nav-link shop-popup-btn" id="shopPopupBtn" type="button">חנות</button>
      <a class="nav-link" href="policy.html">מדיניות</a>
      <a class="nav-link" href="contact.html">צור קשר</a>
    </nav>
    <div class="shop-popup" id="shopPopup">
      <ul>
        <li><a href="shop.html">כללי</a></li>
        <li>
          <button class="popup-main-btn" type="button" data-target="sheshbesh">שש בש</button>
          <ul class="popup-sub" id="sub-sheshbesh">
            <li><a href="Backgammon Custum.html">עיצוב אישי</a></li>
            <li><a href="Backgammon Models.html">דגמים</a></li>
          </ul>
        </li>
        <li>
          <button class="popup-main-btn" type="button" data-target="matkot">מטקות</button>
          <ul class="popup-sub" id="sub-matkot">
            <li><a href="Matka Custum.html">עיצוב אישי</a></li>
            <li><a href="Matka Models.html">דגמים</a></li>
          </ul>
        </li>
        <li><a href="Canvas.html">קנבסים</a></li>
        <li><a href="Record.html">תקליטים</a></li>
      </ul>
    </div>
    <main style="display: flex; flex-direction: column; align-items: center; padding: 0 5vw; box-sizing: border-box;">
      <h2 class="record-title">שם מוצר</h2>
      
      <div class="product-container">
        <!-- Product Details Section -->
        <div class="product-details">
          <div class="notes-section">
            <label class="notes-label" for="notes">הערות/שינויים:</label>
            <textarea id="notes" class="notes-textarea" placeholder="הוסף הערות מיוחדות למוצר..."></textarea>
          </div>

          <div class="quantity-section">
            <label class="quantity-label" for="quantity">כמות:</label>
            <input type="number" id="quantity" class="quantity-input" value="1" min="1">
          </div>

          <div class="price-container">
            <div class="price-amount">₪199</div>
            <button class="add-to-cart-btn" onclick="addToCart()">הוסף לסל</button>
          </div>
        </div>

        <!-- Gallery Section -->
        <div class="product-gallery">
          <div class="thumbnail-container">
            <div class="thumbnail selected" onclick="updateMainImage('product1.jpg', this)">
              <img src="product1.jpg" alt="Thumbnail 1">
            </div>
            <div class="thumbnail" onclick="updateMainImage('product2.jpg', this)">
              <img src="product2.jpg" alt="Thumbnail 2">
            </div>
            <div class="thumbnail" onclick="updateMainImage('product3.jpg', this)">
              <img src="product3.jpg" alt="Thumbnail 3">
            </div>
            <div class="thumbnail" onclick="updateMainImage('product4.jpg', this)">
              <img src="product4.jpg" alt="Thumbnail 4">
            </div>
            <div class="thumbnail" onclick="updateMainImage('product5.jpg', this)">
              <img src="product5.jpg" alt="Thumbnail 5">
            </div>
          </div>
          <div class="main-image">
            <img id="mainImage" src="product1.jpg" alt="Product">
          </div>
        </div>
      </div>
    </main>
    <div class="record-note">במידה ותרצו לבצע שינויים, ייתכן שהמחיר יתעדכן בהתאם.<br>טווח המחירים נע בין 150 ל-350 ש"ח.</div>
    <div id="toast" class="toast">המוצר נוסף לסל בהצלחה!</div>
  </div>
  <footer>
    <div class="footer-content">
      <div class="footer-nav">
        <a href="homepage.html" class="footer-link">דף הבית</a>
        <span class="footer-sep">│</span>
        <a href="shop.html" class="footer-link">חנות</a>
        <span class="footer-sep">│</span>
        <a href="policy.html" class="footer-link">מדיניות</a>
        <span class="footer-sep">│</span>
        <a href="contact.html" class="footer-link">צור קשר</a>
      </div>
      <div class="footer-contact">
        <div class="footer-contact-item">
          <a href="https://www.instagram.com/paintz.official/" target="_blank" rel="noopener">
            <img src="instagram.svg" alt="Instagram" class="footer-icon" />
          </a>
          <span class="footer-contact-text">paintz.official@</span>
        </div>
        <div class="footer-contact-item">
          <a href="mailto:paintz.yf@gmail.com">
            <img src="email.svg" alt="Email" class="footer-icon" />
          </a>
          <span class="footer-contact-text">paintz.yf@gmail.com</span>
        </div>
        <div class="footer-contact-item">
          <a href="https://maps.google.com/?q=פתח+תקווה" target="_blank">
            <img src="location.svg" alt="Location" class="footer-icon" />
          </a>
          <span class="footer-contact-text">פתח תקווה</span>
        </div>
      </div>
    </div>
    <div class="footer-logo"></div>
  </footer>
  <section class="copyright-section">
    <div class="copyright-text">Paintz 2025©</div>
  </section>
  <script src="cart-sync.js"></script>
  <script>
    // וידוא שה-side-cart מוסתר בטעינת הדף
    document.addEventListener('DOMContentLoaded', function() {
      const sideCart = document.getElementById('sideCart');
      if (sideCart) {
        sideCart.classList.remove('active');
      }
      setSubmenuEvents(); // Add this line
    });
// Product data structure
const productData = {
  backgammon: {
    1: { name: "שש בש | 777", price: 250, images: 5 },
    2: { name: "שש בש | בובספוג", price: 300, images: 7 },
    3: { name: "שש בש | דגים", price: 250, images: 6 },
    4: { name: "שש בש | דבורות", price: 200, images: 1 },
    5: { name: "שש בש | דונאלד דאק", price: 250, images: 7 },
    6: { name: "שש בש | דרקון", price: 250, images: 2 },
    7: { name: "שש בש | קוטב צפוני", price: 250, images: 2 },
    8: { name: "שש בש | חלל (שחור)", price: 250, images: 4 },
    9: { name: "שש בש | חיות ים", price: 200, images: 4 },
    10: { name: "שש בש | חלל צבעוני", price: 300, images: 5 },
    11: { name: "שש בש | חמניות", price: 200, images: 1 },
    12: { name: "שש בש | יוגה", price: 300, images: 6 },
    13: { name: "שש בש | ים", price: 200, images: 1 },
    14: { name: "שש בש | מדוזות סגולות", price: 250, images: 2 },
    15: { name: "שש בש | מיניונים", price: 250, images: 2 },
    16: { name: "שש בש | פילים", price: 350, images: 7 },
    17: { name: "שש בש | פרח ורוד 1", price: 300, images: 5 },
    18: { name: "שש בש | פרח ורוד 2", price: 300, images: 7 },
    19: { name: "שש בש | קוקוס", price: 350, images: 6 },
    20: { name: "שש בש | רפונזל", price: 250, images: 1 },
    21: { name: "שש בש | יוון", price: 300, images: 6 },
    22: { name: "שש בש | הגן הקסום", price: 250, images: 5 },
    23: { name: "שש בש | לוויתן", price: 200, images: 4 },
    24: { name: "שש בש | פרינדס", price: 350, images: 7 },
    25: { name: "שש בש | רקדנית", price: 250, images: 5 }
  },
  matka: {
    1: { name: "מטקה | בובספוג", price: 180, images: 5 },
    2: { name: "מטקה | חיות ים", price: 150, images: 7 },
    3: { name: "מטקה | צורות", price: 150, images: 4 },
    4: { name: "מטקה | חמניות", price: 150, images: 1 },
    5: { name: "מטקה | פרפרים", price: 150, images: 1 },
    6: { name: "מטקה | כלב", price: 150, images: 5 }
  }
};

// Function to get URL parameters
function getURLParameter(name) {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get(name);
}

// Function to load product data
function loadProduct() {
  const productType = getURLParameter('product');
  const productId = getURLParameter('id');
  
  if (!productType || !productId || !productData[productType] || !productData[productType][productId]) {
    // Default product if no valid parameters
    loadDefaultProduct();
    return;
  }
  
  const product = productData[productType][productId];
  
  // Update product title
  // הצגת השם עם "|" כמו שצריך
  document.querySelector('.record-title').textContent = product.name;
  
  // Update price
  document.querySelector('.price-amount').textContent = `₪${product.price}`;
  
  // Update images
  updateProductImages(productType, productId, product.images);
}

// Function to update product images
function updateProductImages(productType, productId, imageCount) {
  const thumbnailContainer = document.querySelector('.thumbnail-container');
  const mainImage = document.getElementById('mainImage');
  
  // Clear existing thumbnails
  thumbnailContainer.innerHTML = '';
  
  // Create thumbnails based on image count
  for (let i = 1; i <= imageCount; i++) {
    const imagePath = `Models/${productType === 'backgammon' ? 'Backgammon' : 'Matka'}${productId}_${i}.JPG`;
    
    const thumbnail = document.createElement('div');
    thumbnail.className = `thumbnail ${i === 1 ? 'selected' : ''}`;
    thumbnail.onclick = () => updateMainImage(imagePath, thumbnail);
    
    const img = document.createElement('img');
    img.src = imagePath;
    img.alt = `תמונה ${i}`;
    
    thumbnail.appendChild(img);
    thumbnailContainer.appendChild(thumbnail);
  }
  
  // Set main image to first image
  const firstImagePath = `Models/${productType === 'backgammon' ? 'Backgammon' : 'Matka'}${productId}_1.JPG`;
  mainImage.src = firstImagePath;
  
  // Store the full URL for cart usage
  window.currentProductImageUrl = `https://sweet-youtiao-888fc5.netlify.app/${firstImagePath}`;
}

// Function to load default product
function loadDefaultProduct() {
  document.querySelector('.record-title').textContent = "מוצר לדוגמה";
  document.querySelector('.price-amount').textContent = "₪199";
  
  // Keep existing default images
  const thumbnailContainer = document.querySelector('.thumbnail-container');
  thumbnailContainer.innerHTML = `
    <div class="thumbnail selected" onclick="updateMainImage('product1.jpg', this)">
      <img src="product1.jpg" alt="Thumbnail 1">
    </div>
    <div class="thumbnail" onclick="updateMainImage('product2.jpg', this)">
      <img src="product2.jpg" alt="Thumbnail 2">
    </div>
    <div class="thumbnail" onclick="updateMainImage('product3.jpg', this)">
      <img src="product3.jpg" alt="Thumbnail 3">
    </div>
  `;
  
  document.getElementById('mainImage').src = 'product1.jpg';
}

// Load product when page loads
document.addEventListener('DOMContentLoaded', loadProduct);

// --- Shop Popup Logic ---
const shopBtn = document.getElementById('shopPopupBtn');
const shopPopup = document.getElementById('shopPopup');
function positionShopPopup() {
  const rect = shopBtn.getBoundingClientRect();
  shopPopup.style.top = rect.bottom + 'px';
  shopPopup.style.right = (window.innerWidth - rect.right) + 'px';
  shopPopup.style.left = 'auto';
  shopPopup.style.transform = 'none';
}
function openShopPopup() {
  positionShopPopup();
  shopPopup.style.display = 'block';
}
function closeShopPopup() {
  shopPopup.style.display = 'none';
  closeAllSubs();
}
function setShopPopupEvents() {
  if (window.innerWidth > 700) {
    shopBtn.removeEventListener('click', shopBtn._shopClickHandler || (()=>{}));
    
    // Hover functionality with delay
    let hoverTimeout;
    let isHovering = false;
    
    shopBtn.addEventListener('mouseenter', function() {
      isHovering = true;
      clearTimeout(hoverTimeout);
      openShopPopup();
    });
    
    shopBtn.addEventListener('mouseleave', function() {
      isHovering = false;
      hoverTimeout = setTimeout(() => {
        if (!isHovering) closeShopPopup();
      }, 200);
    });
    
    shopPopup.addEventListener('mouseenter', function() {
      isHovering = true;
      clearTimeout(hoverTimeout);
    });
    
    shopPopup.addEventListener('mouseleave', function() {
      isHovering = false;
      hoverTimeout = setTimeout(() => {
        if (!isHovering) closeShopPopup();
      }, 200);
    });
    
  } else {
    shopBtn._shopClickHandler = function(e) {
      e.stopPropagation();
      if (shopPopup.style.display === 'block') {
        closeShopPopup();
      } else {
        openShopPopup();
      }
    };
    shopBtn.addEventListener('click', shopBtn._shopClickHandler);
  }
}
setShopPopupEvents();
window.addEventListener('resize', setShopPopupEvents);
window.addEventListener('resize', function() {
  if (shopPopup.style.display === 'block') {
    positionShopPopup();
  }
});
document.addEventListener('click', function(e) {
  if (!shopPopup.contains(e.target) && e.target !== shopBtn) {
    closeShopPopup();
  }
});
function closeAllSubs() {
  document.querySelectorAll('.popup-sub').forEach(sub => sub.style.display = 'none');
}
function setSubmenuEvents() {
  const isDesktop = window.innerWidth > 700;
  document.querySelectorAll('.popup-main-btn').forEach(btn => {
    const target = btn.getAttribute('data-target');
    const sub = document.getElementById('sub-' + target);
    btn.replaceWith(btn.cloneNode(true));
  });
  document.querySelectorAll('.popup-main-btn').forEach(btn => {
    const target = btn.getAttribute('data-target');
    const sub = document.getElementById('sub-' + target);
    btn.addEventListener('click', function(e) {
      e.stopPropagation();
      if (sub.style.display === 'block') {
        sub.style.display = 'none';
      } else {
        closeAllSubs();
        sub.style.display = 'block';
      }
    });
    btn.removeEventListener('mouseenter', null);
    btn.removeEventListener('mouseleave', null);
    if (sub) {
      sub.removeEventListener('mouseenter', null);
      sub.removeEventListener('mouseleave', null);
    }
  });
}
setSubmenuEvents();
window.addEventListener('resize', setSubmenuEvents);

// Product Gallery Functions
function updateMainImage(src, clickedThumb) {
  document.getElementById('mainImage').src = src;
  
  // Update thumbnail borders
  document.querySelectorAll('.thumbnail').forEach(thumb => {
    thumb.classList.remove('selected');
  });
  clickedThumb.classList.add('selected');
  
  // Update the stored full URL for cart usage
  if (!src.startsWith('http') && !src.startsWith('data:')) {
    window.currentProductImageUrl = `https://sweet-youtiao-888fc5.netlify.app/${src}`;
  } else {
    window.currentProductImageUrl = src;
  }
}

// Quantity Functions
function updateQuantity(change) {
  const quantityInput = document.getElementById('quantity');
  const currentValue = parseInt(quantityInput.value) || 1;
  const newValue = Math.max(1, currentValue + change);
  quantityInput.value = newValue;
}

// Prevent manual input of negative numbers
document.getElementById('quantity').addEventListener('change', function() {
  if (this.value < 1) this.value = 1;
});

// Replace the validation function with a simple add to cart function
async function addToCart() {
  const productType = getURLParameter('product');
  const productId = getURLParameter('id');
  
  if (!productType || !productId || !productData[productType] || !productData[productType][productId]) {
    alert('שגיאה: לא ניתן לזהות את המוצר');
    return;
  }
  
  const product = productData[productType][productId];
  const quantity = parseInt(document.getElementById('quantity').value) || 1;
  const notes = (document.getElementById('notes').value || '').trim();
  
  // יצירת מוצר חדש לעגלה
  // פרוק שם המוצר לחלקים - מחיקת ה-"|" והפיצול
  const nameParts = product.name.split(' | ');
  const mainTitle = nameParts[0]; // "שש בש"
  const subTitle = nameParts[1]; // "777", "בובספוג", etc.
  
  // Function to convert image URL to base64 (only if already base64)
  function imageUrlToBase64(url) {
    return new Promise((resolve, reject) => {
      if (url && url.startsWith('data:image')) {
        resolve(url);
        return;
      }
      
      // For relative paths, we can't convert to base64 in browser
      // But we can return the full URL for email display
      if (url && !url.startsWith('http') && !url.startsWith('data:')) {
        const fullUrl = `https://yardenfad.github.io/paintz-website/${url}`;
        resolve(fullUrl);
        return;
      }
      
      resolve(url);
    });
  }

  // Get first thumbnail image instead of current main image
  let firstImageSrc = '';
  
  if (productType && productId && productData[productType] && productData[productType][productId]) {
    // For dynamic products, use first image from the series
    firstImageSrc = `Models/${productType === 'backgammon' ? 'Backgammon' : 'Matka'}${productId}_1.JPG`;
  } else {
    // For default products, use first thumbnail
    const firstThumbnail = document.querySelector('.thumbnail img');
    firstImageSrc = firstThumbnail ? firstThumbnail.src : 'product1.jpg';
  }

  // Use stored full URL if available, otherwise convert relative path to full URL
  let fullImageUrl = window.currentProductImageUrl || firstImageSrc;
  if (!fullImageUrl.startsWith('http') && !fullImageUrl.startsWith('data:')) {
    // Use Netlify URL since that's where images are actually hosted
    fullImageUrl = `https://sweet-youtiao-888fc5.netlify.app/${firstImageSrc}`;
  } else if (fullImageUrl.startsWith('https://yardenfad.github.io')) {
    // Convert GitHub Pages URL to Netlify URL
    const path = fullImageUrl.replace('https://yardenfad.github.io/paintz-website/', '');
    fullImageUrl = `https://sweet-youtiao-888fc5.netlify.app/${path}`;
  }

  // Convert image to base64 for email display
  const productImageBase64 = await imageUrlToBase64(fullImageUrl);
  
  const cartItem = {
    title: mainTitle,
    subtitle: subTitle,
    notes: notes,
    desc: '',
    qty: quantity,
    price: `₪ ${product.price}`,
    mainImage: fullImageUrl, // שמירת התמונה עם URL מלא
    img: fullImageUrl, // URL מלא - יוצג במייל
    image: fullImageUrl // גיבוי נוסף לתמונה
  };
  

  
  // טעינת הסל הנוכחי
  if (window.cartSync && typeof window.cartSync.loadCart === 'function') {
    cart = window.cartSync.loadCart();
  } else {
    try {
      cart = JSON.parse(localStorage.getItem('cart') || '[]');
    } catch (e) {
      cart = [];
    }
  }
  
  // בדיקה מלאה של מוצר קיים (כל השדות צריכים להיות זהים!)
  
  const existingItemIndex = window.cartSync && window.cartSync.areItemsIdentical 
    ? cart.findIndex(existing => {
        const result = window.cartSync.areItemsIdentical(existing, cartItem);
        return result;
      })
    : cart.findIndex(item => {
        // בדיקה מיוחדת למוצרי דגמים - אם זה מוצר דגם, עדכן אותו במקום ליצור חדש
        const isModelItem = (item.title === 'מטקה' && !item.notes) || 
                           (item.title + ' ' + item.subtitle).toLowerCase().includes('דגם');
        const isNewModelItem = (cartItem.title === 'מטקה' && !cartItem.notes) || 
                              (cartItem.title + ' ' + cartItem.subtitle).toLowerCase().includes('דגם');
        
        if (isModelItem && isNewModelItem && 
            item.title === cartItem.title && 
            item.subtitle === cartItem.subtitle) {
          // בדוק שההערות זהות
          const existingNotes = (item.notes || '').trim();
          const newNotes = (cartItem.notes || '').trim();
          
          if (existingNotes === newNotes) {
            return true;
          }
          return false;
        }
        
        // בדיקה אם זה מוצר עם הערות זהות או ללא הערות
        const existingNotes = (item.notes || '').trim();
        const newNotes = (cartItem.notes || '').trim();
        
        if (existingNotes === newNotes && 
            item.title === cartItem.title && 
            item.subtitle === cartItem.subtitle) {
          return true;
        }
        
        const result = item.title === cartItem.title && 
          item.subtitle === cartItem.subtitle &&
          ((item.notes || '').trim() === (cartItem.notes || '').trim()) &&
          item.desc === cartItem.desc &&
          item.price === cartItem.price &&
          item.img === cartItem.img &&
          JSON.stringify(item.files || []) === JSON.stringify(cartItem.files || []);
        return result;
      });
  
  if (existingItemIndex !== -1) {
    // בדיקה אם זה מוצר דגם שצריך לעדכן עם הערות
    const existingItem = cart[existingItemIndex];
    const isModelItem = (existingItem.title === 'מטקה' && !existingItem.notes) || 
                       (existingItem.title + ' ' + existingItem.subtitle).toLowerCase().includes('דגם');
    const isNewModelItem = (cartItem.title === 'מטקה' && !cartItem.notes) || 
                          (cartItem.title + ' ' + cartItem.subtitle).toLowerCase().includes('דגם');
    
    if (isModelItem && isNewModelItem && 
        existingItem.title === cartItem.title && 
        existingItem.subtitle === cartItem.subtitle) {
      // עדכן מוצר דגם עם הערות חדשות
      cart[existingItemIndex] = {
        ...existingItem,
        notes: cartItem.notes,
        qty: existingItem.qty + quantity
      };
    } else {
      // בדיקה אם זה מוצר עם הערות זהות
      const existingNotes = (existingItem.notes || '').trim();
      const newNotes = (cartItem.notes || '').trim();
      
      if (existingNotes === newNotes && 
          existingItem.title === cartItem.title && 
          existingItem.subtitle === cartItem.subtitle) {
        // איחוד מוצרים עם הערות זהות
        cart[existingItemIndex].qty += quantity;
      } else {
        // אם המוצר קיים, הוסף כמות
        cart[existingItemIndex].qty += quantity;
      }
    }
  } else {
    // אם המוצר לא קיים, הוסף אותו
    cartItem.qty = quantity;
    cart.push(cartItem);
  }
  
  // שמירה בחזרה עם עדכון מיידי של הממשק
  if (window.cartSync && typeof window.cartSync.saveCart === 'function') {
    window.cartSync.saveCart(cart, true); // Save immediately
  } else {
    localStorage.setItem('cart', JSON.stringify(cart));
  }

  // עדכון מיידי של הממשק
  updateCartBadge();
  renderCart();

  // מציאת האינדקס של המוצר אחרי הוספה
  const targetIndex = window.cartSync && window.cartSync.areItemsIdentical 
    ? cart.findIndex(existing => window.cartSync.areItemsIdentical(existing, cartItem))
    : cart.findIndex(item => {
        // בדיקה מיוחדת למוצרי דגמים
        const isModelItem = (item.title === 'מטקה' && !item.notes) || 
                           (item.title + ' ' + item.subtitle).toLowerCase().includes('דגם');
        const isNewModelItem = (cartItem.title === 'מטקה' && !cartItem.notes) || 
                              (cartItem.title + ' ' + cartItem.subtitle).toLowerCase().includes('דגם');
        
        if (isModelItem && isNewModelItem && 
            item.title === cartItem.title && 
            item.subtitle === cartItem.subtitle) {
          return true;
        }
        
        // בדיקה אם זה מוצר עם הערות זהות או ללא הערות
        const existingNotes = (item.notes || '').trim();
        const newNotes = (cartItem.notes || '').trim();
        
        if (existingNotes === newNotes && 
            item.title === cartItem.title && 
            item.subtitle === cartItem.subtitle) {
          return true;
        }
        
        return item.title === cartItem.title && 
          item.subtitle === cartItem.subtitle &&
          ((item.notes || '').trim() === (cartItem.notes || '').trim()) &&
          item.desc === cartItem.desc &&
          item.price === cartItem.price &&
          item.img === cartItem.img &&
          JSON.stringify(item.files || []) === JSON.stringify(cartItem.files || []);
      });
  
  // פתיחת הסל הקטן אוטומטית עם אנימציה למוצר הנכון
  const finalTargetIndex = targetIndex !== -1 ? targetIndex : cart.length - 1;
  openSideCart(finalTargetIndex);
  
  // הפעלת סנכרון נוסף לוודא שכל הטאבים מתעדכנים
  if (window.cartSync && typeof window.cartSync.synchronize === 'function') {
    setTimeout(() => {
      window.cartSync.synchronize('add-to-cart-complete');
    }, 100);
  }
  
  // איפוס הטופס
  document.getElementById('quantity').value = '1';
  document.getElementById('notes').value = '';
  
  // הצגת הודעה
  const toast = document.getElementById('toast');
  toast.classList.add('show');
  
  setTimeout(() => {
    toast.classList.remove('show');
  }, 3000);
}

// Cart functionality for Product.html
let cart = [];

function initializeCart() {
  if (window.cartSync && typeof window.cartSync.loadCart === 'function') {
    cart = window.cartSync.loadCart();
  } else {
    try {
      cart = JSON.parse(localStorage.getItem('cart') || '[]');
    } catch (e) {
      cart = [];
    }
  }
}

initializeCart();
document.addEventListener('DOMContentLoaded', function() {
  setTimeout(initializeCart, 100);
});

const cartBtn = document.querySelector('.cart');
const sideCart = document.getElementById('sideCart');
const cartOverlay = document.getElementById('cartOverlay');
const closeSideCartBtn = document.getElementById('closeSideCart');
const sideCartList = document.getElementById('sideCartList');
const viewCartBtn = document.getElementById('viewCartBtn');
const cartBadge = document.getElementById('cartBadge');

function getColorFromName(colorName) {
  const colorMap = {
    'אדום': '#FF0000', 'כחול': '#0000FF', 'ירוק': '#008000', 'צהוב': '#FFFF00',
    'כתום': '#FFA500', 'סגול': '#800080', 'ורוד': '#FFC0CB', 'חום': '#A52A2A',
    'שחור': '#000000', 'לבן': '#FFFFFF', 'אפור': '#808080', 'תכלת': '#00CED1',
    'בז\'': '#F5F5DC', 'זהב': '#FFD700', 'כסף': '#C0C0C0', 'ברונזה': '#CD7F32'
  };
  return colorMap[colorName.trim()] || '#ccc';
}

function truncateText(text, maxLength = 10) {
  if (!text) return '';
  return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
}

function updateCartBadge() {
  try {
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');
    const total = cart.reduce((sum, item) => sum + (item.qty || 1), 0);
    if (total > 0) {
      cartBadge.style.display = 'block';
      cartBadge.textContent = total;
    } else {
      cartBadge.style.display = 'none';
    }
  } catch (e) {
    cartBadge.style.display = 'none';
  }
}

function renderCartNotes(item, hidePrices) {
  const details = [];
  let colorBox = '';
  const notesText = item.notes || '';
  const allTitles = ((item.title || '') + ' ' + (item.subtitle || '')).toLowerCase();
  
  // Handle custom backgammon design
  if (allTitles.includes('שש בש') && allTitles.includes('עיצוב אישי')) {
    // ... existing code ...
  } else if (allTitles.includes('מטקה') && allTitles.includes('עיצוב אישי')) {
    // עיבוד מיוחד למטקה עיצוב אישי
    const colors = [];
    const explanations = [];
    
    // בדיקת צבעים והסברים בפורמט הישן
    if (item.colorData) {
      if (item.colorData.color1) {
        details.push(`<span class='side-cart-item-details-label'>צבע מטקה 1: </span><span class='side-cart-item-details-value'><span class='side-cart-item-color-box' style='background:${item.colorData.color1.hex}' title='${item.colorData.color1.text}'></span></span>`);
      }
      if (item.colorData.color2) {
        details.push(`<span class='side-cart-item-details-label'>צבע מטקה 2: </span><span class='side-cart-item-details-value'><span class='side-cart-item-color-box' style='background:${item.colorData.color2.hex}' title='${item.colorData.color2.text}'></span></span>`);
      }
      if (item.colorData.desc1) {
        details.push(`<span class='side-cart-item-details-label'>הסבר מטקה 1: </span><span class='side-cart-item-details-value'>${truncateText(item.colorData.desc1, 10)}</span>`);
      }
      if (item.colorData.desc2) {
        details.push(`<span class='side-cart-item-details-label'>הסבר מטקה 2: </span><span class='side-cart-item-details-value'>${truncateText(item.colorData.desc2, 10)}</span>`);
      }
    } else {
      // בדיקת צבעים והסברים בפורמט החדש
      const matkaRegex = /(צבע מטקה [12]|הסבר מטקה [12]):\s*([^,]+)(?=,\s*(?:צבע מטקה|הסבר מטקה)|$)/g;
      let match;
      const foundLabels = new Set();
      
      while ((match = matkaRegex.exec(notesText)) !== null) {
        const label = match[1];
        const value = match[2].trim();
        foundLabels.add(label);
        
        if (label.includes('צבע מטקה')) {
          const colorHex = getColorFromName(value);
          details.push(`<span class='side-cart-item-details-label'>${label}: </span><span class='side-cart-item-details-value'><span class='side-cart-item-color-box' style='background:${colorHex}' title='${value}'></span></span>`);
        } else if (label.includes('הסבר מטקה')) {
          details.push(`<span class='side-cart-item-details-label'>${label}: </span><span class='side-cart-item-details-value'>${truncateText(value, 10)}</span>`);
        }
      }
      
      // הוספת תוויות חסרות עם ערכים ריקים
      ['צבע מטקה 1', 'צבע מטקה 2', 'הסבר מטקה 1', 'הסבר מטקה 2'].forEach(label => {
        if (!foundLabels.has(label)) {
          if (label.includes('צבע')) {
            details.push(`<span class='side-cart-item-details-label'>${label}: </span><span class='side-cart-item-details-value'></span>`);
          } else {
            details.push(`<span class='side-cart-item-details-label'>${label}: </span><span class='side-cart-item-details-value'></span>`);
          }
        }
      });
    }
    
    // הוספת קבצים אם יש
    if (item.files && item.files.length > 0) {
      const fileName = item.files[0].name;
      details.push(`<span class='side-cart-item-details-label'>קובץ: </span><span class='side-cart-item-details-value'>${truncateText(fileName, 10)}</span>`);
    } else if (item.file) {
      const fileName = item.file.split(/[\/\\]/).pop();
      details.push(`<span class='side-cart-item-details-label'>קובץ: </span><span class='side-cart-item-details-value'>${truncateText(fileName, 10)}</span>`);
    }
  } else if (allTitles.includes('תקליט') && allTitles.includes('עיצוב אישי')) {
    // ... existing code ...
  } else {
    // ... existing code ...
  }

  // Return different formats based on hidePrices (true = big cart, false = mini cart)
  if (hidePrices) {
    // For big cart - return UL format
    return details.length ? `<ul class='big-cart-item-notes' style='list-style:none;margin:0 0 2px 0;padding:0;'>${details.map(detail => `<li>${detail}</li>`).join('')}</ul>` : '';
  } else {
    // For mini cart - return DIV format  
    return details.map(detail => `<div style="font-family: 'Amatica SC', cursive;">${detail}</div>`).join('');
  }
}

  function renderCart() {
    sideCartList.innerHTML = '';
    
    if (!cart.length) {
      sideCartList.innerHTML = '<div style="text-align: center; padding: 20px; font-family: \'Amatica SC\', cursive; font-size: 20px; color: #775A47;">העגלה ריקה</div>';
      return;
    }
    
    cart.forEach((item, idx) => {
      const row = document.createElement('div');
      row.className = 'side-cart-item';
      row.setAttribute('data-idx', idx);
      row.style.position = 'relative';
      row.innerHTML = `
        <div style="height: 120px; display: flex; flex-direction: row; width: 100%; position: relative;">
          <div style="flex: 1; height: 100%; display: flex; align-items: center;">
            <div style="width: 100%; display: flex; flex-direction: column; gap: 8px;">
              <div style="height: 30px; display: flex; align-items: center; justify-content: center;">
                <span style="font-family: 'Amatica SC', cursive; font-size: 22px; font-weight: bold; color: #775A47; text-align: center; line-height: 1.1;">${item.title}</span>
              </div>
              <div style="height: 24px; display: flex; align-items: center; justify-content: center;">
                <span style="font-family: 'Amatica SC', cursive; font-size: 16px; color: #BA8663; text-align: center; font-weight: normal;">${item.subtitle}</span>
              </div>
              ${window.cartSync && window.cartSync.renderCartPrice ? window.cartSync.renderCartPrice(item) : ''}
            </div>
          </div>
          <div style="width: 48px; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; margin-left: 8px;">
            <button class="side-cart-item-add-btn" title="הוסף" style="background: none; border: none; font-size: 22px; color: #5EA189; cursor: pointer; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;">+</button>
            <span class="side-cart-item-qty" style="width: 32px; height: 28px; font-size: 18px; color: #BA8663; display: flex; align-items: center; justify-content: center; background: none; border-radius: 0; border: none; font-family: 'Amatica SC', cursive; font-weight: bold;">${item.qty}</span>
            <button class="side-cart-item-minus-btn" title="הפחת" style="background: none; border: none; font-size: 22px; color: #5EA189; cursor: pointer; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;">–</button>
          </div>
        </div>
        <div class="side-cart-item-details" style="padding: 0 0 8px 0;">
          <ul class="side-cart-item-details-list">
            ${window.cartSync && window.cartSync.renderCartNotes ? window.cartSync.renderCartNotes(item, false) : renderCartNotes(item, false)}
          </ul>
        </div>
        <button class="side-cart-item-trash-btn" title="מחק" style="position: absolute; left: 8px; bottom: 8px; background: none; border: none; padding: 0; margin: 0; cursor: pointer; width: 22px; height: 22px;"><span class="side-cart-item-trash-icon"></span></button>
      `;
      
      row.querySelector('.side-cart-item-trash-btn').onclick = function(e) {
        e.stopPropagation();
        showDeleteDialog(idx);
      };
      
      // כפתור הוספה
      row.querySelector('.side-cart-item-add-btn').onclick = function(e) {
        e.stopPropagation();
        if (window.cartSync && typeof window.cartSync.updateItem === 'function') {
          window.cartSync.updateItem(idx, {qty: cart[idx].qty + 1});
          cart = window.cartSync.loadCart();
        } else {
          cart[idx].qty += 1;
          localStorage.setItem('cart', JSON.stringify(cart));
        }

        // טעינה מחדש לוודא סנכרון מיד
        setTimeout(() => {
          if (window.cartSync && typeof window.cartSync.loadCart === 'function') {
            cart = window.cartSync.loadCart();
          } else {
            cart = JSON.parse(localStorage.getItem('cart') || '[]');
          }
          
          updateCartBadge();
          renderCart();
        }, 50);
      };
      // כפתור הפחתה
      row.querySelector('.side-cart-item-minus-btn').onclick = function(e) {
        e.stopPropagation();
        if (cart[idx].qty > 1) {
          if (window.cartSync && typeof window.cartSync.updateItem === 'function') {
            window.cartSync.updateItem(idx, {qty: cart[idx].qty - 1});
            cart = window.cartSync.loadCart();
          } else {
            cart[idx].qty -= 1;
            localStorage.setItem('cart', JSON.stringify(cart));
          }

          // טעינה מחדש לוודא סנכרון מיד
          setTimeout(() => {
            if (window.cartSync && typeof window.cartSync.loadCart === 'function') {
              cart = window.cartSync.loadCart();
            } else {
              cart = JSON.parse(localStorage.getItem('cart') || '[]');
            }
            
            updateCartBadge();
            renderCart();
          }, 50);
        } else {
          showDeleteDialog(idx);
        }
      };
      
      sideCartList.appendChild(row);
    });
  }

function openSideCart(scrollToItemIndex = false) {
  sideCart.classList.add('active');
  cartOverlay.classList.add('active');
  document.body.style.overflow = 'hidden';
  
  // אם צריך לגלול למוצר ספציפי
  if (scrollToItemIndex !== false && cart.length > 0) {
    setTimeout(() => {
      const cartItems = sideCartList.querySelectorAll('.side-cart-item');
      if (cartItems.length > 0) {
        let targetItem;
        
        if (scrollToItemIndex === true) {
          // ברירת מחדל - המוצר האחרון
          targetItem = cartItems[cartItems.length - 1];
        } else if (typeof scrollToItemIndex === 'number') {
          // מוצר ספציפי לפי אינדקס
          targetItem = cartItems[scrollToItemIndex] || cartItems[cartItems.length - 1];
        }
        
        if (targetItem) {
          // אנימציית קפיצה למוצר 
          targetItem.style.transform = 'scale(1.1)';
          targetItem.style.background = 'linear-gradient(135deg, #f0f8f0, #e8f5e8)';
          targetItem.style.border = '2px solid #5EA189';
          targetItem.style.borderRadius = '8px';
          targetItem.style.transition = 'all 0.3s ease';
          
          // גלילה למוצר
          targetItem.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
          });
          
          // החזרה לגודל הרגיל אחרי אנימציה
          setTimeout(() => {
            targetItem.style.transform = 'scale(1)';
            targetItem.style.background = '';
            targetItem.style.border = '';
            targetItem.style.borderRadius = '';
          }, 1500);
        }
      }
    }, 200);
  }
}

function closeSideCart() {
  sideCart.classList.remove('active');
  cartOverlay.classList.remove('active');
  document.body.style.overflow = '';
}

cartBtn.addEventListener('click', function(e) {
  e.preventDefault();
  openSideCart();
});

cartOverlay.addEventListener('click', closeSideCart);
closeSideCartBtn.addEventListener('click', closeSideCart);

viewCartBtn.addEventListener('click', function() {
  window.location.href = 'Shopping Cart.html';
});

function removeFromCart(idx) {
  if (idx >= 0 && idx < cart.length) {
    if (window.cartSync && typeof window.cartSync.removeItem === 'function') {
      window.cartSync.removeItem(idx);
      cart = window.cartSync.loadCart();
    } else {
        cart.splice(idx, 1);
        localStorage.setItem('cart', JSON.stringify(cart));
    }

    // טעינה מחדש לוודא סנכרון מיד
    setTimeout(() => {
      if (window.cartSync && typeof window.cartSync.loadCart === 'function') {
        cart = window.cartSync.loadCart();
      } else {
        cart = JSON.parse(localStorage.getItem('cart') || '[]');
      }
      
      updateCartBadge();
      renderCart();
    }, 50);
  }
}

let cartDeleteIdx = null;
function showDeleteDialog(idx) {
  cartDeleteIdx = idx;
  document.getElementById('cartDeleteDialog').style.display = 'flex';
}

document.getElementById('cartDeleteYes').onclick = function() {
  if (cartDeleteIdx !== null) {
    removeFromCart(cartDeleteIdx);
    cartDeleteIdx = null;
  }
  document.getElementById('cartDeleteDialog').style.display = 'none';
};

document.getElementById('cartDeleteNo').onclick = function() {
  cartDeleteIdx = null;
  document.getElementById('cartDeleteDialog').style.display = 'none';
};

  // Initialize
loadProduct();
updateCartBadge();
renderCart();

// Wait for cart sync to be available, then reinitialize
window.addEventListener('load', function() {
  setTimeout(() => {
    if (window.cartSync) {
      cart = window.cartSync.loadCart();
      updateCartBadge();
      renderCart();
    }
  }, 100);
});

// Also update on storage changes
window.addEventListener('storage', function(e) {
  if (e.key === 'cart') {
    try {
      cart = JSON.parse(localStorage.getItem('cart') || '[]');
      updateCartBadge();
      renderCart();
    } catch (error) {
      console.error('Error syncing cart:', error);
    }
  }
});

// iPad and Safari specific fixes
function ensureViewCartButtonVisibleOniPad() {
  const viewCartBtn = document.getElementById('viewCartBtn');
  if (viewCartBtn) {
    viewCartBtn.style.display = 'block';
    viewCartBtn.style.visibility = 'visible';
    viewCartBtn.style.opacity = '1';
    viewCartBtn.style.position = 'sticky';
    viewCartBtn.style.bottom = '0';
    viewCartBtn.style.zIndex = '9999';
    viewCartBtn.style.webkitTransform = 'none';
    viewCartBtn.style.transform = 'none';
  }
}

// Call the function multiple times to ensure it works
setTimeout(ensureViewCartButtonVisibleOniPad, 100);
setTimeout(ensureViewCartButtonVisibleOniPad, 500);
setTimeout(ensureViewCartButtonVisibleOniPad, 1000);
setTimeout(ensureViewCartButtonVisibleOniPad, 2000);
  </script>
</body>
</html> 